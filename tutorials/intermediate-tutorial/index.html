<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.64">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-130598673-3","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="Redux Toolkit" href="/redux-toolkit/opensearch.xml"><title data-react-helmet="true">Tutorial intermediário | Redux Toolkit</title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" property="og:image" content="https://fernandobelotto.github.io/redux-toolkit/img/redux-logo-landscape.png"><meta data-react-helmet="true" property="twitter:image" content="https://fernandobelotto.github.io/redux-toolkit/img/redux-logo-landscape.png"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for Redux Toolkit"><meta data-react-helmet="true" name="twitter:card" content="summary"><meta data-react-helmet="true" property="og:title" content="Tutorial intermediário | Redux Toolkit"><meta data-react-helmet="true" name="description" content="Tutorial intermediário: Redux Toolkit em ação"><meta data-react-helmet="true" property="og:description" content="Tutorial intermediário: Redux Toolkit em ação"><meta data-react-helmet="true" property="og:url" content="https://fernandobelotto.github.io/redux-toolkit/tutorials/intermediate-tutorial"><link data-react-helmet="true" rel="shortcut icon" href="/redux-toolkit/img/favicon/favicon.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="true"><link data-react-helmet="true" rel="canonical" href="https://fernandobelotto.github.io/redux-toolkit/tutorials/intermediate-tutorial"><link rel="stylesheet" href="/redux-toolkit/styles.98acaeb6.css">
<link rel="preload" href="/redux-toolkit/styles.8e2df2eb.js" as="script">
<link rel="preload" href="/redux-toolkit/runtime~main.f2ffa899.js" as="script">
<link rel="preload" href="/redux-toolkit/main.8855d00d.js" as="script">
<link rel="preload" href="/redux-toolkit/1.57fadc6f.js" as="script">
<link rel="preload" href="/redux-toolkit/2.ffe88765.js" as="script">
<link rel="preload" href="/redux-toolkit/27.ed6da2e2.js" as="script">
<link rel="preload" href="/redux-toolkit/30.fc892cc4.js" as="script">
<link rel="preload" href="/redux-toolkit/f976f453.b05aa0e0.js" as="script">
<link rel="preload" href="/redux-toolkit/17896441.8e146be0.js" as="script">
<link rel="preload" href="/redux-toolkit/0fdf4150.60d954f6.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/redux-toolkit/"><img class="navbar__logo" src="/redux-toolkit/img/redux.svg" alt="Redux Logo"><strong class="navbar__title">Redux Toolkit</strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/redux-toolkit/introduction/quick-start">Começo rápido</a><a class="navbar__item navbar__link" href="/redux-toolkit/api/configureStore">API</a><a href="https://github.com/reduxjs/redux-toolkit" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">⌘</span><span class="DocSearch-Button-Key">K</span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/redux-toolkit/"><img class="navbar__logo" src="/redux-toolkit/img/redux.svg" alt="Redux Logo"><strong class="navbar__title">Redux Toolkit</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/redux-toolkit/introduction/quick-start">Começo rápido</a></li><li class="menu__list-item"><a class="menu__link" href="/redux-toolkit/api/configureStore">API</a></li><li class="menu__list-item"><a href="https://github.com/reduxjs/redux-toolkit" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Introdução</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/redux-toolkit/introduction/quick-start">Início Rápido</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Tutoriais</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/redux-toolkit/tutorials/basic-tutorial">Basic Tutorial</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/redux-toolkit/tutorials/intermediate-tutorial">Tutorial intermediário</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/redux-toolkit/tutorials/advanced-tutorial">Advanced Tutorial</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Usando Redux Toolkit</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/redux-toolkit/usage/usage-guide">Guia de uso</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/redux-toolkit/usage/usage-with-typescript">Uso com TypeScript</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Referência de API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Configuração da Store</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/redux-toolkit/api/configureStore">configureStore</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/redux-toolkit/api/getDefaultMiddleware">getDefaultMiddleware</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/redux-toolkit/api/immutabilityMiddleware">Immutability Middleware</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/redux-toolkit/api/serializabilityMiddleware">Serializability Middleware</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Reducers e Actions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/redux-toolkit/api/createReducer">createReducer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/redux-toolkit/api/createAction">createAction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/redux-toolkit/api/createSlice">createSlice</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/redux-toolkit/api/createAsyncThunk">createAsyncThunk</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/redux-toolkit/api/createEntityAdapter">createEntityAdapter</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Outros</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/redux-toolkit/api/createSelector">createSelector</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/redux-toolkit/api/matching-utilities">Matching Utilities</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/redux-toolkit/api/other-exports">Outras Exportações</a></li></ul></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><div class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="tutorial-intermediário-redux-toolkit-em-ação"></a>Tutorial intermediário: Redux Toolkit em ação<a aria-hidden="true" tabindex="-1" class="hash-link" href="#tutorial-intermediário-redux-toolkit-em-ação" title="Direct link to heading">#</a></h1><p>No <a href="/redux-toolkit/tutorials/basic-tutorial">Tutorial básico</a>, você viu as principais funções da API que estão incluídas no Redux Toolkit e alguns exemplos curtos de por que e como usá-las. Você também viu que pode usar Redux e RTK a partir de uma tag de script JS simples em uma página HTML, sem usar React, NPM, Webpack ou quaisquer ferramentas de build.</p><p>Neste tutorial, você verá como usar essas APIs em um pequeno aplicativo React. Especificamente, vamos converter o <a href="https://redux.js.org/introduction/examples#todos" target="_blank" rel="noopener noreferrer">aplicativo de exemplo &quot;todos&quot; original do Redux</a> para usar RTK.</p><p>Isso mostrará vários conceitos:</p><ul><li>Como converter o código &quot;Redux simples&quot; para usar RTK</li><li>Como usar RTK em um aplicativo React + Redux típico</li><li>Como alguns dos recursos mais poderosos do RTK podem ser usados ​​para simplificar seu código Redux</li></ul><p>Além disso, embora isso não seja específico do RTK, veremos algumas maneiras de melhorar seu código React-Redux também.</p><p>O código-fonte completo para o aplicativo convertido deste tutorial está disponível em <a href="https://github.com/reduxjs/rtk-convert-todos-example" target="_blank" rel="noopener noreferrer">github.com/reduxjs/rtk-convert-todos-example</a>. Percorreremos o processo de conversão, conforme mostrado no histórico deste repo. Links para commits individuais significativos serão destacados em blocos de citações, como este:</p><blockquote><ul><li>Commit message here</li></ul></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="revisando-o-exemplo-redux-todos"></a>Revisando o exemplo Redux Todos<a aria-hidden="true" tabindex="-1" class="hash-link" href="#revisando-o-exemplo-redux-todos" title="Direct link to heading">#</a></h2><p>Se inspecionarmos <a href="https://github.com/reduxjs/redux/tree/9c9a4d2a1c62c9dbddcbb05488f8bd77d24c81de/examples/todos/src" target="_blank" rel="noopener noreferrer">o código-fonte de exemplo &quot;todos&quot; atual</a>, podemos observar algumas coisas:</p><ul><li>A função reducer <a href="https://github.com/reduxjs/redux/blob/9c9a4d2a1c62c9dbddcbb05488f8bd77d24c81de/examples/todos/src/reducers/todos.js" target="_blank" rel="noopener noreferrer"><code>todos</code></a> está fazendo atualizações imutáveis &quot;à mão&quot;, copiando objetos aninhados e arrays</li><li>O <a href="https://github.com/reduxjs/redux/blob/9c9a4d2a1c62c9dbddcbb05488f8bd77d24c81de/examples/todos/src/actions/index.js" target="_blank" rel="noopener noreferrer">arquivo <code>actions</code></a> tem funções action creators escritas à mão e as strings de tipo de action estão sendo duplicados entre o arquivo de actions e os arquivos de reducers</li><li>O código é apresentado usando uma <a href="https://redux.js.org/faq/code-structure#what-should-my-file-structure-look-like-how-should-i-group-my-action-creators-and-reducers-in-my-project-where-should-my-selectors-go" target="_blank" rel="noopener noreferrer">estrutura &quot;pasta por tipo&quot;</a>, com arquivos separados para <code>actions</code> e <code>reducers</code></li><li>Os componentes React são escritos usando uma versão estrita do padrão <a href="https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0" target="_blank" rel="noopener noreferrer">&quot;container/presentational&quot;</a>, onde <a href="https://github.com/reduxjs/redux/tree/9c9a4d2a1c62c9dbddcbb05488f8bd77d24c81de/examples/todos/src/components" target="_blank" rel="noopener noreferrer">os componentes &quot;presentational&quot; estão em uma pasta</a>, e as definições de conexão <a href="https://github.com/reduxjs/redux/tree/9c9a4d2a1c62c9dbddcbb05488f8bd77d24c81de/examples/todos/src/containers" target="_blank" rel="noopener noreferrer">Redux &quot;contêiner&quot; estão em uma pasta diferente</a></li><li>Parte do código não está seguindo alguns dos padrões de &quot;melhores práticas&quot; do Redux que recomendados. Veremos alguns exemplos específicos ao longo deste tutorial.</li></ul><p>Por um lado, este é um pequeno aplicativo de exemplo. O objetivo é ilustrar os fundamentos do uso real de React e Redux juntos, e não necessariamente ser usado como &quot;a maneira certa&quot; de fazer as coisas em um aplicativo de produção em escala real. Por outro lado, a maioria das pessoas usará os padrões que vêem em documentos e exemplos e, definitivamente, há espaço para melhorias aqui.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="etapas-de-conversão-inicial"></a>Etapas de conversão inicial<a aria-hidden="true" tabindex="-1" class="hash-link" href="#etapas-de-conversão-inicial" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="adicionando-redux-toolkit-ao-projeto"></a>Adicionando Redux Toolkit ao projeto<a aria-hidden="true" tabindex="-1" class="hash-link" href="#adicionando-redux-toolkit-ao-projeto" title="Direct link to heading">#</a></h3><p>Como o exemplo de todos original está no repositório Redux, começamos copiando o código-fonte &quot;todos&quot; do Redux para um novo projeto Create-React-App e adicionando Prettier ao projeto para ajudar a garantir que o código seja formatado de forma consistente. Há também um arquivo <a href="https://code.visualstudio.com/docs/languages/jsconfig" target="_blank" rel="noopener noreferrer">jsconfig.json</a> para nos permitir usar &quot;caminhos de importação absolutos&quot; que começam na pasta <code>/src</code>.</p><blockquote><ul><li><a href="https://github.com/reduxjs/rtk-convert-todos-example/commit/a8e0a9a9d77b9dcd9e881079e7cca449084ca7b1" target="_blank" rel="noopener noreferrer">Commit inicial</a>.</li><li><a href="https://github.com/reduxjs/rtk-convert-todos-example/commit/b866e205b9ebece84367f11d2faabc557bd08e23" target="_blank" rel="noopener noreferrer">Adicione jsconfig.json para suportar importações absolutas</a></li></ul></blockquote><p>No tutorial básico, acabamos de criar um link para o Redux Toolkit como uma tag de script individual. Mas, em um aplicativo típico, você precisa adicionar RTK como uma dependência de pacote em seu projeto. Isso pode ser feito com os gerenciadores de pacotes NPM ou Yarn:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#778090"># Se você estiver usando o NPM:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#E6D874">npm</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">install</span><span class="token plain"> @reduxjs/toolkit</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#778090"># Ou com Yarn:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#E6D874">yarn</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">add</span><span class="token plain"> @reduxjs/toolkit</span></div></div></div></div></div><p>Depois de concluído, você deve adicionar e confirmar o arquivo <code>package.json</code> modificado e o &quot;arquivo lock&quot; do seu gerenciador de pacotes (<code>package-lock.json</code> para NPM, ou <code>yarn.lock</code> para Yarn).</p><blockquote><ul><li><a href="https://github.com/reduxjs/rtk-convert-todos-example/commit/c3f47aeaecf855561e4db9d452b928f1b8b6c016" target="_blank" rel="noopener noreferrer">Adicionar Redux Toolkit</a></li></ul></blockquote><p>Feito isso, podemos começar a trabalhar no código.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="convertendo-a-store-para-usar-configurestore"></a>Convertendo a store para usar <code>configureStore</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#convertendo-a-store-para-usar-configurestore" title="Direct link to heading">#</a></h3><p>Assim como no exemplo do &quot;contador&quot;, podemos substituir a função simples do Redux <code>createStore</code> pelo<code> configureStore</code> do RTK. Isso configurará automaticamente a extensão Redux DevTools para nós.</p><p>As mudanças aqui são simples. Atualizamos <code>src/index.js</code> para importar <code>configureStore</code> em vez da <code>createStore</code>, e substituímos a chamada da função. Lembre-se de que <code>configureStore</code> recebe um objeto de opções como um parâmetro com campos nomeados, então em vez de passar <code>rootReducer</code> diretamente como o primeiro parâmetro, nós o passamos como um campo de objeto chamado <code>reducer</code>:</p><blockquote><ul><li><a href="https://github.com/reduxjs/rtk-convert-todos-example/commit/cdfc15edbd82beda9ef0521aa191574b6cc7695a" target="_blank" rel="noopener noreferrer">Converter a store para usar configureStore</a></li></ul></blockquote><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-diff codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token plain">import React from &quot;react&quot;;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">import { render } from &quot;react-dom&quot;;</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token deleted-sign deleted" style="color:#F92672">-import { createStore } from &quot;redux&quot;;</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+import { configureStore } from &quot;@reduxjs/toolkit&quot;;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain">import { Provider } from &quot;react-redux&quot;;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">import App from &quot;./components/App&quot;;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">import rootReducer from &quot;./reducers&quot;;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token deleted-sign deleted" style="color:#F92672">- const store = createStore(rootReducer);</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+ const store = configureStore({</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+   reducer: rootReducer,</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+});</span></div></div></div></div></div><p><strong>Observe que ainda estamos usando a mesma função de redutor de raiz que já está no aplicativo e uma Redux store ainda está sendo criada. Tudo o que mudou é que a sotre é configurada automaticamente com ferramentas para ajudá-lo no desenvolvimento.</strong></p><p>Se você tiver <a href="https://github.com/zalmoxisus/redux-devtools-extension" target="_blank" rel="noopener noreferrer">a extensão do navegador Redux DevTools</a> instalada, você agora deve ser capaz de ver o estado atual se iniciar o aplicativo no modo de desenvolvimento e abrir a Extensão DevTools. Algo assim:</p><p><img alt="Redux DevTools Extension screenshot showing initial state" src="/redux-toolkit/assets/images/int-tut-01-redux-devtools-7d5791a49c7eecdb47a3cbf97f436222.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="criando-o-todos-slice"></a>Criando o Todos Slice<a aria-hidden="true" tabindex="-1" class="hash-link" href="#criando-o-todos-slice" title="Direct link to heading">#</a></h2><p>A primeira grande etapa para reescrever o aplicativo é converter a lógica Todos em um novo &quot;slice&quot;.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="entendendo-slices"></a>Entendendo Slices<a aria-hidden="true" tabindex="-1" class="hash-link" href="#entendendo-slices" title="Direct link to heading">#</a></h3><p>No momento, o código todos está dividido em duas partes. A lógica do reducer está em <code>reducers/todos.js</code>, enquanto os action creators estão em <code>actions/index.js</code>. Em um aplicativo maior, podemos até ver as constantes de tipo de action em seu próprio arquivo, como <code>constants/todos.js</code>, para que possam ser reutilizadas em ambos os lugares.</p><p>Nós <em>podemos</em> substituir aqueles que usam as funções <a href="/redux-toolkit/api/createReducer"><code>createReducer</code></a> e <a href="/redux-toolkit/api/createAction"><code>createAction</code></a>. No entanto, a função do RTK <a href="/redux-toolkit/api/createSlice"><code>createSlice</code></a> nos permite consolidar essa lógica em um só lugar. Ele usa <code>createReducer</code> e <code>createAction</code> internamente, então <strong>na maioria dos aplicativos, você não precisa usá-los - <code>createSlice</code> é tudo que você precisa</strong>.</p><p>Você pode estar se perguntando, &quot;o que é um &#x27;slice&#x27;, afinal?&quot;. Uma aplicação Redux normal tem um objeto JS no topo de sua árvore de estado, e esse objeto é o resultado da chamada da função Redux <a href="https://redux.js.org/api/combinereducers" target="_blank" rel="noopener noreferrer"><code>combineReducers</code></a> para juntar múltiplos o reducer funciona em um &quot;reducer raiz&quot; maior. <strong>Referimo-nos a uma seção de chave/valor desse objeto como &quot;slice&quot; e usamos o termo <a href="https://redux.js.org/recipes/structuring-reducers/splitting-reducer-logic" target="_blank" rel="noopener noreferrer">&quot;reducer slice&quot;</a> para descrever a função reducer responsável por atualizar aquela slice (fatia) do estado</strong>.</p><p>Neste aplicativo, o reducer raiz se parece com:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-js codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> todos </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;./todos&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> visibilityFilter </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;./visibilityFilter&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">default</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">combineReducers</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  todos</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  visibilityFilter</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span></div></div></div></div></div><p>Portanto, o estado combinado se parece com <code>{todos: [], visibilityFilter:&quot; SHOW_ALL&quot;}</code>. <code>state.todos</code> é uma &quot;slice&quot;, e a função reducer <code>todos</code> é um &quot;slice reducer&quot;.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="examinando-o-reducer-de-todos-original"></a>Examinando o reducer de todos original<a aria-hidden="true" tabindex="-1" class="hash-link" href="#examinando-o-reducer-de-todos-original" title="Direct link to heading">#</a></h3><p>A lógica do reducer todos original se parece com isto:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-js codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">todos</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state </span><span class="token parameter operator" style="color:#F8F8F2">=</span><span class="token parameter"> </span><span class="token parameter punctuation" style="color:#F8F8F2">[</span><span class="token parameter punctuation" style="color:#F8F8F2">]</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">type</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">case</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;ADD_TODO&#x27;</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token spread operator" style="color:#F8F8F2">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">          id</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">id</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">          text</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">text</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">          completed</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token boolean" style="color:#AE81FF">false</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">case</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;TOGGLE_TODO&#x27;</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#F92672">return</span><span class="token plain"> state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">map</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        todo</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">===</span><span class="token plain"> action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">?</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token spread operator" style="color:#F8F8F2">...</span><span class="token plain">todo</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> completed</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">!</span><span class="token plain">todo</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">completed</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> todo</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword module" style="color:#F92672">default</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#F92672">return</span><span class="token plain"> state</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">default</span><span class="token plain"> todos</span></div></div></div></div></div><p>Podemos ver que ele lida com três casos:</p><ul><li>Adiciona um novo todo copiando o array <code>state</code> existente e adicionando uma nova entrada de todo no final</li><li>Ele lida com alternar uma entrada de todo copiando o array existente usando <code>state.map()</code>, copia e substitui o objeto de todos que precisa ser atualizado e deixa todas as outras entradas de todos sozinhas.</li><li>Ele responde a todas as outras actions retornando o estado existente (efetivamente dizendo &quot;Não me importo com essa action&quot;).</li></ul><p>Ele também inicializa o estado com um valor padrão de <code>[]</code> e faz uma exportação padrão da função reducer.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="escrevendo-o-slice-reducer"></a>Escrevendo o slice reducer<a aria-hidden="true" tabindex="-1" class="hash-link" href="#escrevendo-o-slice-reducer" title="Direct link to heading">#</a></h3><p>Podemos fazer o mesmo trabalho com <code>createSlice</code>, mas podemos fazê-lo de uma forma mais simples.</p><p>Começaremos adicionando um novo arquivo chamado <code>/features/todos/todosSlice.js</code>. Observe que, embora não importe como você realmente estrutura suas pastas e arquivos, descobrimos que <a href="https://redux.js.org/faq/code-structure#what-should-my-file-structure-look-like-how-should-i-group-my-action-creators-and-reducers-in-my-project-where-should-my-selectors-go" target="_blank" rel="noopener noreferrer">uma abordagem de &quot;pasta de recursos&quot;</a> geralmente funciona melhor para a maioria formulários. O nome do arquivo também depende inteiramente de você, mas é razoável usar uma convenção de <code>someFeatureSlice.js</code>.</p><p>Neste arquivo, adicionaremos a seguinte lógica:</p><blockquote><ul><li><a href="https://github.com/reduxjs/rtk-convert-todos-example/commit/48ce059dbb0fce1b961631821534fbcb766d3471" target="_blank" rel="noopener noreferrer">Adicionar um slice inicial de todos</a></li></ul></blockquote><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-js codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> createSlice </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;@reduxjs/toolkit&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> todosSlice </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">createSlice</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  name</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;todos&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  initialState</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  reducers</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">addTodo</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> id</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> text </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">payload</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">push</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> id</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> text</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> completed</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token boolean" style="color:#AE81FF">false</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">toggleTodo</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> todo </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">find</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">todo</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> todo</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">===</span><span class="token plain"> action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#F92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">todo</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        todo</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">completed</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">!</span><span class="token plain">todo</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">completed</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> addTodo</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> toggleTodo </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> todosSlice</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">actions</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">default</span><span class="token plain"> todosSlice</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">reducer</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="opções-de-createslice"></a>Opções de <code>createSlice</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#opções-de-createslice" title="Direct link to heading">#</a></h4><p>Vamos analisar o que isso faz:</p><ul><li><code>createSlice</code> takes an options object as its argument, with these options:<ul><li><code>name</code>: a string that is used as the prefix for generated action types</li><li><code>initialState</code>: the initial state value for the reducer</li><li><code>reducers</code>: an object, where the keys will become action type strings, and the functions are reducers that will be run when that action type is dispatched. (These are sometimes referred to as <a href="https://redux.js.org/recipes/structuring-reducers/splitting-reducer-logic" target="_blank" rel="noopener noreferrer">&quot;case reducers&quot;</a>, because they&#x27;re similar to a <code>case</code> in a <code>switch</code> statement)</li></ul></li></ul><p>Assim, a função reducer de caso <code>addTodo</code> será executada quando uma action com o tipo <code>&quot;todos/addTodo&quot;</code> for despachada.</p><p>Não há manipulador <code>default</code> aqui. O reducer gerado por <code>createSlice</code> irá lidar automaticamente com todos os outros tipos de action, retornando o estado atual, então não temos que listar isso nós mesmos.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="atualizar-lógica-mutável"></a>Atualizar Lógica &quot;Mutável&quot;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#atualizar-lógica-mutável" title="Direct link to heading">#</a></h4><p>Observe que o reducer <code>addTodo</code> está chamando <code>state.push()</code>. Normalmente, isso é ruim, porque <a href="https://doesitmutate.xyz/#push" target="_blank" rel="noopener noreferrer">a função <code>array.push()</code> altera o array existente</a> e <strong><a href="Https://redux.js.org/basics/reducers#handling-actions" target="_blank" rel="noopener noreferrer">Redux reducers devem <em>nunca</em> sofrer mutação!</a></strong>.</p><p>No entanto, <code>createSlice</code> e <code>createReducer</code> envolvem sua função com <a href="https://github.com/immerjs/immer" target="_blank" rel="noopener noreferrer"><code>produce</code> da biblioteca Immer</a>. <strong>Isso significa que você pode escrever um código que &quot;modifique&quot; o estado dentro do reducer, e o Immer retornará com segurança um resultado correto atualizado imutavelmente.</strong></p><p>Da mesma forma, <code>toggleTodo</code> não mapeia o array nem copia o objeto de todos correspondente. Em vez disso, ele apenas encontra o objeto de todo correspondente e o altera atribuindo <code>todo.completed = !Todo.completed</code>. Novamente, o Immer sabe que esse objeto foi atualizado e faz cópias do objeto todo e do array que o contém.</p><p>A lógica normal de atualização imutável tende a obscurecer o que você está realmente tentando fazer por causa de todas as cópias extras que precisam acontecer. Aqui, a intenção deve ser muito mais clara: estamos adicionando um item ao final de uma matriz e modificando um campo em uma entrada de tarefas.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="exportando-as-funções-do-slice"></a>Exportando as funções do Slice<a aria-hidden="true" tabindex="-1" class="hash-link" href="#exportando-as-funções-do-slice" title="Direct link to heading">#</a></h4><p><code>createSlice</code> retorna um objeto parecido com este:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-js codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  name</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;todos&quot;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function-variable function" style="color:#E6D874">reducer</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> newState</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  actions</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function-variable function" style="color:#E6D874">addTodo</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">payload</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain">type</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;todos/addTodo&quot;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> payload</span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function-variable function" style="color:#E6D874">toggleTodo</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">payload</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain">type</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;todos/toggleTodo&quot;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> payload</span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  caseReducers</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function-variable function" style="color:#E6D874">addTodo</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> newState</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function-variable function" style="color:#E6D874">toggleTodo</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> newState</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span></div></div></div></div></div><p><strong>Observe que ele gerou automaticamente as funções actions creators apropriadas <em>e</em> tipos de action para cada um de nossos reducers - não precisamos escrevê-los à mão!</strong></p><p>Precisaremos usar os action creators e o reducer em outros arquivos, então, no mínimo, precisaríamos exportar o objeto slice. No entanto, podemos usar uma convenção de código da comunidade Redux chamada <a href="https://github.com/erikras/ducks-modular-redux" target="_blank" rel="noopener noreferrer">o padrão &quot;ducks&quot;</a>. Simplificando, <strong>ele sugere que você deve colocar todos os seus action creators e reducers em um arquivo, fazer exportações nomeadas dos action creators e uma exportação padrão da função reducer</strong>.</p><p>Graças ao <code>createSlice</code>, já temos nossos action creators e reducer bem aqui em um arquivo. Tudo o que temos a fazer é exportá-los separadamente e nosso arquivo de slice agora corresponde ao padrão comum &quot;ducks&quot;.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="trabalhando-com-payloads"></a>Trabalhando com payloads<a aria-hidden="true" tabindex="-1" class="hash-link" href="#trabalhando-com-payloads" title="Direct link to heading">#</a></h4><p>Falando dos action creators, vamos voltar e reexaminar a lógica do reducer por um minuto.</p><p>Por padrão, os action creators da função RTK <code>createAction</code> aceitam apenas um argumento. Esse argumento, seja ele qual for, é colocado no objeto de action como um campo chamado <code>payload</code>.</p><p>Não há nada de especial sobre o campo <code>action.payload</code> por si só. Redux não conhece ou se preocupa com esse nome. Mas, como &quot;ducks&quot;, o nome <code>payload</code> vem de outra convenção da comunidade Redux chamada <a href="https://github.com/redux-utilities/flux-standard-action" target="_blank" rel="noopener noreferrer">&quot;Flux Standard Actions&quot;</a>.</p><p>As actions geralmente precisam incluir alguns dados extras junto com o campo <code>type</code>. O código Redux original para <code>addTodo</code> tem um objeto de action que se parece com <code>{type, id, text}</code>. <strong>A convenção FSA sugere que em vez de ter campos de dados com nomes aleatórios diretamente no objeto de action, você deve sempre colocar seus dados dentro de um campo denominado <code>payload</code></strong>.</p><p>Cabe ao reudcer estabelecer o que ele pensa que a <code>payload</code> deve ser para cada tipo de action, e qualquer código que despache a action precisa passar valores que correspondam a essa expectativa. Se apenas um valor for necessário, você poderia usá-lo diretamente como o valor <code>payload</code> inteiro. Mais comumente, você precisa passar vários valores; nesse caso, <code>payload</code> deve ser um objeto contendo esses valores.</p><p>Em nosso slice todos, <code>addTodo</code> precisa de dois campos, <code>id</code> e <code>text</code>, então os colocamos em um objeto como <code>payload</code>. Para <code>toggleTodo</code>, o único valor que precisamos é o <code>id</code> do todo sendo alterado. Poderíamos ter feito isso como <code>payload</code>, mas eu prefiro sempre ter <code>payload</code> como um objeto, então eu fiz <code>action.payload.id</code>.</p><p>(Como uma prévia: existe <em>sim</em> uma maneira de personalizar como os payloads do objeto de action são criados. Veremos isso mais tarde neste tutorial, ou você pode consultar <a href="/redux-toolkit/api/createAction">os documentos da API <code>createAction</code></a> para obter uma explicação.)</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="atualizando-os-testes-todos"></a>Atualizando os Testes Todos<a aria-hidden="true" tabindex="-1" class="hash-link" href="#atualizando-os-testes-todos" title="Direct link to heading">#</a></h3><p>O reducer de todos original tem um arquivo de testes com ele. Podemos transferi-los para trabalhar com nosso slice de todos e verificar se ambos funcionam da mesma maneira.</p><p>O primeiro passo é copiar <code>reducers/todos.spec.js</code> para <code>features/todos/todosSlice.spec.js</code>, e alterar o caminho de importação para ler o reducer do arquivo slice.</p><blockquote><ul><li><a href="https://github.com/reduxjs/rtk-convert-todos-example/commit/b603312ddf55899e8a75522d407c40474948ae0b" target="_blank" rel="noopener noreferrer">Copie os testes para todos slice</a></li></ul></blockquote><p>Feito isso, precisamos atualizar os testes para corresponder ao funcionamento do RTK.</p><p>O primeiro problema é que o arquivo de teste codifica os tipos de action como <code>&#x27;ADD_TODO&#x27;</code>. Os tipos de action do RTK se parecem com <code>&#x27;todos/addTodo&#x27;</code>. Podemos fazer referência a isso importando também os action creators da slice todos e substituindo as constantes de tipo original no teste por <code>addTodo.type</code>.</p><p>O outro problema é que os objetos de action nos testes se parecem com <code>{type, id, text}</code>, enquanto o RTK sempre coloca esses valores extras dentro de <code>action.payload</code>. Portanto, precisamos modificar as actions de teste para corresponder a isso.</p><p>(Nós realmente <em>podemos</em> apenas substituir todos os objetos de action inline no teste por chamadas como <code>addTodo ({id: 0, text:&quot; Buy milk &quot;})</code>, mas este é um conjunto mais simples de alterações para mostrar por enquanto.)</p><blockquote><ul><li><a href="https://github.com/reduxjs/rtk-convert-todos-example/commit/39dbbf37bd4c559db956c8291bbd0bf1135546bb" target="_blank" rel="noopener noreferrer">Transfira os testes todos para trabalhar com o slice todos</a></li></ul></blockquote><p>Um exemplo das mudanças seria:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-diff codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token plain">// Altere as importações para obter os action creators</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token deleted-sign deleted" style="color:#F92672">-import todos from &#x27;./todosSlice&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+import todos, { addTodo, toggleTodo } from &#x27;./todosSlice&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">// depois, em um teste:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token unchanged">  it(&#x27;should handle ADD_TODO&#x27;, () =&gt; {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">    expect(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">      todos([], {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged"></span><span class="token deleted-sign deleted" style="color:#F92672">-       type: &#x27;ADD_TODO&#x27;,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-       text: &#x27;Run the tests&#x27;,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-       id: 0</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+       type: addTodo.type,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+       payload: {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+         text: &#x27;Run the tests&#x27;,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+         id: 0</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+       }</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token unchanged">      })</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">    ).toEqual([</span></div></div></div></div></div><p>Após essas mudanças, todos os testes em <code>todosSlice.spec.js</code> devem passar, provando que nosso novo reducer de slice RTK funciona exatamente da mesma forma que o reducer original escrito à mão!</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="implementando-ids-de-todo"></a>Implementando IDs de Todo<a aria-hidden="true" tabindex="-1" class="hash-link" href="#implementando-ids-de-todo" title="Direct link to heading">#</a></h3><p>No código original, cada todo recém-adicionada obtém um valor de ID (um número crescente):</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-js codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">let</span><span class="token plain"> nextTodoId </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token number" style="color:#AE81FF">0</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">addTodo</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token parameter">text</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  type</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;ADD_TODO&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  id</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> nextTodoId</span><span class="token operator" style="color:#F8F8F2">++</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  text</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span></div></div></div></div></div><p>No momento, nosso slice de todos não faz isso, porque o action creator <code>addTodo</code> é gerado automaticamente para nós.</p><p>Nós <em>podemos</em> adicionar esse comportamento para exigir que qualquer código que envie o add todo deva passar um novo ID, como <code>addTodo ({id: 1, text: &quot;Buy milk&quot;})</code>, mas isso seria irritante. Por que o chamador deve rastrear esse valor? Além disso, e se houver várias partes do aplicativo que precisariam despachar essa action? Seria melhor encapsular essa lógica no action creator.</p><p>O RTK permite que você personalize como o campo <code>payload</code> é criado em seus objetos de action. Se você estiver usando <code>createAction</code> por si só, pode passar um &quot;prepare callback&quot; como o segundo argumento. Esta seria a aparência:</p><blockquote><ul><li><a href="https://github.com/reduxjs/rtk-convert-todos-example/commit/0c9e3b721c209d368d23a70cf8faca8f308ff8df" target="_blank" rel="noopener noreferrer">Implementar geração de ID addTodo</a></li></ul></blockquote><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-js codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">let</span><span class="token plain"> nextTodoId </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token number" style="color:#AE81FF">0</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> addTodo </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">createAction</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;ADD_TODO&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token parameter">text</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    payload</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> id</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> nextTodoId</span><span class="token operator" style="color:#F8F8F2">++</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> text </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span></div></div></div></div></div><p><strong>Observe que o &quot;preparar callback&quot; <em>deve</em> retornar um objeto com um campo chamado <code>payload</code> dentro!</strong> Caso contrário, o payload da action será undefined. Ele <em>pode</em> também incluir um campo chamado <code>meta</code>, que pode ser usado para incluir metadados adicionais adicionais relacionados à action.</p><p>Se você estiver usando <code>createSlice</code>, ele chama automaticamente <code>createAction</code> para você. Se precisar personalizar a carga útil lá, você pode fazer isso passando um objeto contendo as funções <code>reducer</code> e <code>prepare</code> para o objeto <code>reducers</code>, em vez de apenas a função reducer em si:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-js codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">let</span><span class="token plain"> nextTodoId </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token number" style="color:#AE81FF">0</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> todosSlice </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">createSlice</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  name</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;todos&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  initialState</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  reducers</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    addTodo</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token function" style="color:#E6D874">reducer</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> id</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> text </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">payload</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">push</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> id</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> text</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> completed</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token boolean" style="color:#AE81FF">false</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token function" style="color:#E6D874">prepare</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">text</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> payload</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> text</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> id</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> nextTodoId</span><span class="token operator" style="color:#F8F8F2">++</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span></div></div></div></div></div><p>Podemos adicionar um teste adicional que confirma que isso funciona:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-js codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#E6D874">describe</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;addTodo&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#E6D874">it</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;should generate incrementing todo IDs&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> action1 </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">addTodo</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;a&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> action2 </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">addTodo</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;b&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">expect</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">action1</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">toEqual</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> id</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token number" style="color:#AE81FF">0</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> text</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;a&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">expect</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">action2</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">toEqual</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> id</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token number" style="color:#AE81FF">1</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> text</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;b&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="usando-o-novo-slice-de-todos"></a>Usando o Novo Slice de Todos<a aria-hidden="true" tabindex="-1" class="hash-link" href="#usando-o-novo-slice-de-todos" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="atualizando-o-reducer-raiz"></a>Atualizando o reducer raiz<a aria-hidden="true" tabindex="-1" class="hash-link" href="#atualizando-o-reducer-raiz" title="Direct link to heading">#</a></h3><p>Temos uma função reducer totalmente nova e brilhante, mas ela ainda não está conectada a nada.</p><p>A primeira etapa é atualizar nosso reducer root para usar o slice reducer todos em vez do reducer original. Precisamos apenas alterar a instrução de importação em <code>reducers/index.js</code>:</p><blockquote><ul><li><a href="https://github.com/reduxjs/rtk-convert-todos-example/commit/7b6e005377c856d7415e328387188260330ebae4" target="_blank" rel="noopener noreferrer">Use o slice reducer todos</a></li></ul></blockquote><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-diff codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token plain">import { combineReducers } from &#x27;redux&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token deleted-sign deleted" style="color:#F92672">-import todos from &#x27;./todos&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+import todosReducer from &#x27;features/todos/todosSlice&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain">import visibilityFilter from &#x27;./visibilityFilter&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">export default combineReducers({</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token deleted-sign deleted" style="color:#F92672">- todos,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+ todos: todosReducer,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token unchanged">  visibilityFilter</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged"></span><span class="token plain">})</span></div></div></div></div></div><p>Embora pudéssemos ter mantido a função importada nomeada como <code>todos</code> para que possamos usar a abreviação literal do objeto com <code>combineReducers</code>, é um pouco mais claro se nomearmos a função importada como <code>todosReducer</code> e definir o campo como <code>todos: todosReducer</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="atualizando-o-componente-add-todo"></a>Atualizando o componente Add Todo<a aria-hidden="true" tabindex="-1" class="hash-link" href="#atualizando-o-componente-add-todo" title="Direct link to heading">#</a></h3><p>Se recarregarmos o aplicativo, ainda devemos ver que <code>state.todos</code> é um array vazio. Mas, se clicarmos em &quot;Adicionar Todo&quot;, nada acontecerá. Ainda estamos despachando ações cujo tipo é <code>&#x27;ADD_TODO&#x27;</code>, enquanto nosso slice de todos está procurando por um tipo de ação <code>&#x27;todos/addTodo&#x27;</code>. Precisamos importar o action creator correta e usá-lo no arquivo <code>AddTodo.js</code>.</p><p>Já que estamos nisso, existem alguns outros problemas com como o componente <code>AddTodo</code> é escrito. Primeiro, ele está usando uma &quot;referência de retorno&quot; do React para ler o valor de texto atual da entrada quando você clica em &quot;Add Todo&quot;. Isso funciona, mas a &quot;forma de reação&quot; padrão para lidar com os campos do formulário é com o padrão de &quot;entradas controladas&quot;, onde o valor do campo atual é armazenado no estado do componente.</p><p>Em segundo lugar, o componente conectado está recebendo <code>dispatch</code> como prop. Novamente, isso funciona, mas a maneira normal de usar connect é <a href="https://react-redux.js.org/using-react-redux/connect-mapdispatch" target="_blank" rel="noopener noreferrer">passar as funções do action creator para <code>connect</code></a> e, em seguida, despacha as action chamando as funções que foram passadas como props.</p><p>Uma vez que temos esse componente aberto, podemos corrigir esses problemas também. Esta é a aparência da versão final:</p><blockquote><ul><li><a href="https://github.com/reduxjs/rtk-convert-todos-example/commit/d7082409ebaa113b74f6989bf70ee09600f37d0b" target="_blank" rel="noopener noreferrer">Atualizar AddTodo para despachar o novo tipo de action</a></li></ul></blockquote><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-js codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token maybe-class-name">React</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> useState </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;react&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> connect </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;react-redux&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> addTodo </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;features/todos/todosSlice&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> mapDispatch </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> addTodo </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color:#E6D874">AddTodo</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter punctuation" style="color:#F8F8F2">{</span><span class="token parameter"> addTodo </span><span class="token parameter punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token plain">todoText</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> setTodoText</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">useState</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">onChange</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token parameter">e</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">setTodoText</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">target</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">value</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token plain">div</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token plain">form</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        onSubmit</span><span class="token operator" style="color:#F8F8F2">=</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token parameter">e</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">          e</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">preventDefault</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token keyword" style="color:#F92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token operator" style="color:#F8F8F2">!</span><span class="token plain">todoText</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">trim</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token keyword" style="color:#F92672">return</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token function" style="color:#E6D874">addTodo</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">todoText</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token function" style="color:#E6D874">setTodoText</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token plain">input value</span><span class="token operator" style="color:#F8F8F2">=</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain">todoText</span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> onChange</span><span class="token operator" style="color:#F8F8F2">=</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain">onChange</span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">/</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token plain">button type</span><span class="token operator" style="color:#F8F8F2">=</span><span class="token string" style="color:#a6e22e">&quot;submit&quot;</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token maybe-class-name">Add</span><span class="token plain"> </span><span class="token maybe-class-name">Todo</span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token operator" style="color:#F8F8F2">/</span><span class="token plain">button</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token operator" style="color:#F8F8F2">/</span><span class="token plain">form</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token operator" style="color:#F8F8F2">/</span><span class="token plain">div</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">default</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">connect</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token keyword null nil" style="color:#F92672">null</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> mapDispatch</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token maybe-class-name">AddTodo</span><span class="token punctuation" style="color:#F8F8F2">)</span></div></div></div></div></div><p>Começamos importando o action creator <code>addTodo</code> correto de nosso slice de todos.</p><p>A entrada agora está sendo tratada como uma &quot;entrada controlada&quot; padrão, com o valor do texto sendo armazenado no estado do componente. Podemos usar esse valor de texto de estado no manipulador de envio do formulário.</p><p>Finalmente, usamos a forma <a href="https://react-redux.js.org/using-react-redux/connect-mapdispatch#defining-mapdispatchtoprops-as-an-object" target="_blank" rel="noopener noreferrer">&quot;abreviação de objeto&quot; de <code>mapDispatch</code></a> para simplifique a passagem dos action creator para <code>connect</code>. A versão &quot;vinculada&quot; de <code>addTodo</code> é passada para o componente como um prop e despachará a action assim que a chamarmos.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="atualizando-a-lista-de-todos"></a>Atualizando a lista de todos<a aria-hidden="true" tabindex="-1" class="hash-link" href="#atualizando-a-lista-de-todos" title="Direct link to heading">#</a></h3><p>Os componentes <code>TodoList</code> e <code>VisibleTodoList</code> têm problemas semelhantes: eles estão usando o antigo action creator <code>toggleTodo</code>, e a configuração <code>connect</code> não está usando a forma &quot;abreviação de objeto&quot; de <code>mapDispatch</code>. Podemos consertar ambos.</p><blockquote><ul><li><a href="https://github.com/reduxjs/rtk-convert-todos-example/commit/b47b2124d6a28386b7461bccb9216682a81edb3e" target="_blank" rel="noopener noreferrer">Atualize TodoList para despachar o novo tipo de action de toggle</a></li></ul></blockquote><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-diff codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token plain">// VisibleTodoList.js</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token deleted-sign deleted" style="color:#F92672">-import { toggleTodo } from &#x27;../actions&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+import { toggleTodo } from &#x27;features/todos/todosSlice&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token deleted-sign deleted" style="color:#F92672">-const mapDispatchToProps = dispatch =&gt; ({</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">- toggleTodo: id =&gt; dispatch(toggleTodo(id))</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-})</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+const mapDispatchToProps = { toggleTodo }</span></div></div></div></div></div><p>E com isso, agora devemos ser capazes de adicionar e alternar todos novamente, mas usando nosso novo slice de todos!</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="criando-e-usando-o-slice-de-filtros"></a>Criando e usando o slice de filtros<a aria-hidden="true" tabindex="-1" class="hash-link" href="#criando-e-usando-o-slice-de-filtros" title="Direct link to heading">#</a></h2><p>Agora que criamos o slice todos e o conectamos à IU, podemos fazer o mesmo para a lógica de seleção de filtro.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="escrevendo-o-slice-de-filtros"></a>Escrevendo o slice de filtros<a aria-hidden="true" tabindex="-1" class="hash-link" href="#escrevendo-o-slice-de-filtros" title="Direct link to heading">#</a></h3><p>A lógica do filtro é muito simples. Temos uma action, que define o valor do filtro atual, retornando o que está na action. Aqui está a fatia inteira:</p><blockquote><ul><li><a href="https://github.com/reduxjs/rtk-convert-todos-example/commit/b77f4155e3b45bce24d0d0ef6e2f7b0c3bd11ee1" target="_blank" rel="noopener noreferrer">Add the filters slice</a></li></ul></blockquote><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-js codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> createSlice </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;@reduxjs/toolkit&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token maybe-class-name">VisibilityFilters</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token constant" style="color:#F92672">SHOW_ALL</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;SHOW_ALL&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token constant" style="color:#F92672">SHOW_COMPLETED</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;SHOW_COMPLETED&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token constant" style="color:#F92672">SHOW_ACTIVE</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;SHOW_ACTIVE&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> filtersSlice </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">createSlice</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  name</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;visibilityFilters&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  initialState</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token maybe-class-name">VisibilityFilters</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token constant" style="color:#F92672">SHOW_ALL</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  reducers</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">setVisibilityFilter</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#F92672">return</span><span class="token plain"> action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">payload</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> setVisibilityFilter </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> filtersSlice</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">actions</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">default</span><span class="token plain"> filtersSlice</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">reducer</span></div></div></div></div></div><p>Copiamos o objeto enum <code>VisibilityFilters</code> que estava originalmente em <code>actions/index.js</code>. O código do slice apenas cria um reducer, exportamos o action creator e o reducer e pronto.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="usando-a-slice-de-filtros"></a>Usando a Slice de filtros<a aria-hidden="true" tabindex="-1" class="hash-link" href="#usando-a-slice-de-filtros" title="Direct link to heading">#</a></h3><p>Assim como com o reducer todos, precisamos importar e adicionar o reducer de visibilidade ao nosso reducer root:</p><blockquote><ul><li><a href="https://github.com/reduxjs/rtk-convert-todos-example/commit/623c47b1987914a1d90142824892686ec76c20a1" target="_blank" rel="noopener noreferrer">Use o slice reducer de filtros</a></li></ul></blockquote><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-diff codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token plain">import todosReducer from &#x27;features/todos/todosSlice&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token deleted-sign deleted" style="color:#F92672">-import visibilityFilter from &#x27;./visibilityFilter&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+import visibilityFilterReducer from &#x27;features/filters/filtersSlice&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">export default combineReducers({</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token unchanged">  todos: todosReducer,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged"></span><span class="token deleted-sign deleted" style="color:#F92672">- visibilityFilter</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+ visibilityFilter: visibilityFilterReducer</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain">})</span></div></div></div></div></div><p>A partir daí, precisamos despachar a action <code>setVisibilityFilter</code> quando o usuário clicar nos botões. Primeiro, para consistência, devemos atualizar <code>VisibleTodoList.js</code> e <code>Footer.js</code> para usar o enum <code>VisibilityFilter</code> que é exportado do arquivo do slice de filtro, em vez daquele do arquivo de actions.</p><p>A partir daí, os componentes do link darão um pouco mais de trabalho. <code>FilterLink</code> está atualmente criando novas funções que capturam o valor atual de <code>ownProps.filter</code>, de modo que <code>Link</code> está apenas obtendo uma função chamada <code>onClick</code>. Embora seja uma maneira válida de fazer isso, para consistência, gostaríamos de continuar usando a forma abreviada de objeto de <code>mapDispatch</code> e modificar<code> Link</code> para passar o valor do filtro quando ele despacha a action.</p><blockquote><ul><li><a href="https://github.com/reduxjs/rtk-convert-todos-example/commit/776b39088384513ff68af41039fe5fc5188fe8fb" target="_blank" rel="noopener noreferrer">Use a nova action de filter na UI</a></li></ul></blockquote><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-diff codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token plain">// FilterLink.js</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token deleted-sign deleted" style="color:#F92672">-import { setVisibilityFilter } from &#x27;../actions&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+import { setVisibilityFilter } from &#x27;features/filters/filtersSlice&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token deleted-sign deleted" style="color:#F92672">-const mapDispatchToProps = (dispatch, ownProps) =&gt; ({</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">- onClick: () =&gt; dispatch(setVisibilityFilter(ownProps.filter))</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-})</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+const mapDispatchToProps = { setVisibilityFilter }</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">// Link.js</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">import React from &#x27;react&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">import PropTypes from &#x27;prop-types&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token deleted-sign deleted" style="color:#F92672">-const Link = ({ active, children, onClick }) =&gt; (</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+const Link = ({ active, children, setVisibilityFilter, filter }) =&gt; (</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token unchanged">  &lt;button</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged"></span><span class="token deleted-sign deleted" style="color:#F92672">-    onClick={onClick}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+    onClick={() =&gt; setVisibilityFilter(filter)}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token unchanged">    disabled={active}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">    style={{</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">      marginLeft: &#x27;4px&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">    }}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">  &gt;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">    {children}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">  &lt;/button&gt;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged"></span><span class="token plain">)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Link.propTypes = {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token unchanged">  active: PropTypes.bool.isRequired,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">  children: PropTypes.node.isRequired,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged"></span><span class="token deleted-sign deleted" style="color:#F92672">- onClick: PropTypes.func.isRequired</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+ setVisibilityFilter: PropTypes.func.isRequired,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+ filter: PropTypes.string.isRequired</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">export default Link</span></div></div></div></div></div><p>Novamente, observe que a maior parte disso não tem a ver com RTK especificamente, mas é bom tentar usar de forma consistente algumas das melhores práticas recomendadas neste código de exemplo.</p><p>Feito isso, devemos ser capazes de adicionar algumas todos, alternar o estado de algumas delas e, em seguida, alternar os filtros para alterar a lista de exibição.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="otimizando-a-filtragem-de-todo"></a>Otimizando a filtragem de todo<a aria-hidden="true" tabindex="-1" class="hash-link" href="#otimizando-a-filtragem-de-todo" title="Direct link to heading">#</a></h2><p>O componente <code>VisibleTodoList</code> atualmente usa uma função chamada <code>getVisibleTodos</code> para fazer o trabalho de filtrar o array de todos para exibição. Esta é uma &quot;função selector&quot;, conforme descrito na página Redux docs em <a href="https://redux.js.org/recipes/computing-derived-data" target="_blank" rel="noopener noreferrer">Computing Derived Data</a>. Ele encapsula o processo de leitura de valores da Redux store e extração de parte ou todos esses valores para uso.</p><p>No entanto, o código como escrito atualmente tem um problema. Se o filtro for definido como <code>SHOW_COMPLETED</code> ou <code>SHOW_ACTIVE</code>, ele <em>sempre</em> retornará um novo array toda vez que for chamado. Já que está sendo usado em uma função <code>mapState</code>, isso significa que ele retornará uma nova referência de array quando <em>qualquer</em> action for despachada.</p><p>Neste pequeno aplicativo de exemplo de todos, isso não é um problema. As únicas action que temos envolvem alterar a lista de todos ou filtrá-la, de qualquer maneira. Mas, em um aplicativo real, muitas outras actions serão despachadas. Imagine se este aplicativo de tarefas tivesse um contador e <code>&quot;INCREMENT&quot;</code> fosse despachado enquanto a lista era filtrada. Criaríamos uma nova lista e <code>TodoList</code> teria que ser renderizado novamente, mesmo que nada mudasse.</p><p>Embora esse não seja um problema real de desempenho agora, vale a pena mostrar como podemos melhorar o comportamento.</p><p>Aplicativos Redux normalmente usam uma biblioteca chamada <a href="https://github.com/reduxjs/reselect" target="_blank" rel="noopener noreferrer">Reselect</a>, que tem uma função <code>createSelector</code> que permite definir funções selectors &quot;memoizadas&quot;. Esses selectors memoizados apenas recalculam os valores se as entradas foram realmente alteradas.</p><p>O RTK reexporta a função <code>createSelector</code> de Reselect, para que possamos importá-la e usá-la em <code>VisibleTodoList</code>.</p><blockquote><ul><li><a href="https://github.com/reduxjs/rtk-convert-todos-example/commit/4fc943b7111381974f20f74750a114b5e52ce1b2" target="_blank" rel="noopener noreferrer">Converter todos visíveis em um selector memoizado</a></li></ul></blockquote><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-diff codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token plain">import { connect } from &#x27;react-redux&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+import { createSelector } from &#x27;@reduxjs/toolkit&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain">import { toggleTodo } from &#x27;features/todos/todosSlice&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">import TodoList from &#x27;../components/TodoList&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">import { VisibilityFilters } from &#x27;features/filters/filtersSlice&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token deleted-sign deleted" style="color:#F92672">-const getVisibleTodos = (todos, filter) =&gt; {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-  switch (filter) {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-    case VisibilityFilters.SHOW_ALL:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-      return todos</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-    case VisibilityFilters.SHOW_COMPLETED:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-      return todos.filter(t =&gt; t.completed)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-    case VisibilityFilters.SHOW_ACTIVE:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-      return todos.filter(t =&gt; !t.completed)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-    default:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-      throw new Error(&#x27;Unknown filter: &#x27; + filter)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-  }</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+const selectTodos = state =&gt; state.todos</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+const selectFilter = state =&gt; state.visibilityFilter</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+const selectVisibleTodos = createSelector(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+  [selectTodos, selectFilter],</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+  (todos, filter) =&gt; {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+    switch (filter) {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+      case VisibilityFilters.SHOW_ALL:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+        return todos</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+      case VisibilityFilters.SHOW_COMPLETED:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+        return todos.filter(t =&gt; t.completed)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+      case VisibilityFilters.SHOW_ACTIVE:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+        return todos.filter(t =&gt; !t.completed)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+      default:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+        throw new Error(&#x27;Unknown filter: &#x27; + filter)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+    }</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+  }</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">const mapStateToProps = state =&gt; ({</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token deleted-sign deleted" style="color:#F92672">- todos: getVisibleTodos(state.todos, state.visibilityFilter)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+ todos: selectVisibleTodos(state)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain">})</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">const mapDispatchToProps = { toggleTodo }</span></div></div></div></div></div><p>Primeiro, importamos <code>createSelector</code> do RTK, e definimos algumas funções selectors de uma linha que pegam os campos <code>todos</code> e <code>visibilityFilter</code> de seu argumento <code>state</code>.</p><p>Em seguida, chamamos <code>createSelector</code> e passamos essas duas pequenas funções de seletor no array &quot;input selector&quot;. <code>createSelector</code> irá chamá-los, pegar os valores de retorno e passá-los para o &quot;output selector&quot; que definimos, que pode então fazer a filtragem e retornar o resultado final.</p><p>Há algumas pequenas mudanças em como isso é definido e usado. Embora você possa dar às funções selectors qualquer nome que desejar, <code>selectX</code> é uma convenção de nomenclatura mais comum do que <code>getX</code>. Além disso, como os input selectors se encarregam de ler os valores necessários, podemos apenas chamar <code>selectVisibleTodos(state)</code>, com <code>state</code> como o único argumento.</p><p>Se executarmos novamente o aplicativo, a lógica de filtragem <em>deve</em> funcionar exatamente da mesma maneira que antes, pelo que você pode ver na IU.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cleanup"></a>Cleanup<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cleanup" title="Direct link to heading">#</a></h2><p>Esse é o fim do trabalho de conversão. Agora temos vários arquivos de action e reducers que não estão mais sendo usados, portanto, devemos excluí-los para limpar o projeto.</p><p>Podemos remover com segurança <code>actions/index.js</code>, <code>reducers/todos.js</code>, <code>reducers/visibilityFilter.js</code> e os arquivos de teste associados.</p><p>Também podemos tentar mudar completamente da estrutura &quot;pasta por tipo&quot; para uma estrutura de &quot;pasta de recursos&quot;, movendo todos os arquivos de componentes para as pastas de recursos correspondentes.</p><blockquote><ul><li><a href="https://github.com/reduxjs/rtk-convert-todos-example/commit/fbc0b965949e082748b8613b734612226ffe9e94" target="_blank" rel="noopener noreferrer">Remover arquivos de actino e reducers não utilizados</a></li><li><a href="https://github.com/reduxjs/rtk-convert-todos-example/commit/138cc162b1cc9c64ab67fae0a1171d07940414e6" target="_blank" rel="noopener noreferrer">Consolidar componentes em pastas de recursos</a></li></ul></blockquote><p>Se fizermos isso, a estrutura do código-fonte final ficará assim:</p><ul><li><code>/src</code><ul><li><code>/components</code><ul><li><code>App.js</code></li></ul></li><li><code>/features</code><ul><li><code>/filters</code><ul><li><code>FilterLink.js</code></li><li><code>filtersSlice.js</code></li><li><code>Footer.js</code></li><li><code>Link.js</code></li></ul></li><li><code>/todos</code><ul><li><code>AddTodo.js</code></li><li><code>Todo.js</code></li><li><code>TodoList.js</code></li><li><code>todosSlice.js</code></li><li><code>todosSlice.spec.js</code></li><li><code>VisibleTodoList.js</code></li></ul></li></ul></li><li><code>/reducers</code><ul><li><code>index.js</code></li></ul></li><li><code>index.js</code></li></ul></li></ul><p>Todos têm preferências diferentes sobre o que torna uma estrutura de pastas &quot;sustentável&quot;, mas no geral esse resultado parece bastante consistente e fácil de seguir.</p><p>Agora, vamos ver a versão final do código em ação!</p><iframe src="https://codesandbox.io/embed/rtk-convert-todos-example-uqqy3?fontsize=14&amp;hidenavigation=1&amp;module=%2Fsrc%2Ffeatures%2Ftodos%2FtodosSlice.js&amp;theme=dark&amp;view=editor" style="width:100%;height:500px;border:0;border-radius:4px;overflow:hidden" title="rtk-convert-todos-example" allow="geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media; usb" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="resumo"></a>Resumo<a aria-hidden="true" tabindex="-1" class="hash-link" href="#resumo" title="Direct link to heading">#</a></h2><p>Neste tutorial, você viu:</p><ul><li>Como usar RTK em um aplicativo React típico, incluindo adicionar o pacote, gravar arquivos &quot;slice&quot; e despachar actions de componentes React</li><li>Como usar reducers &quot;mutáveis&quot;, preparar payload de actions e escrever funções seletors</li><li>Algumas técnicas para simplificar o código React-Redux, como usar a forma &quot;abreviação de objeto&quot; de <code>mapDispatch</code></li><li>Exemplos de como usar uma estrutura de &quot;pasta de recursos&quot; para organizar seu código.</li></ul><p>Esperamos isso ajudou a ilustrar como realmente usar esses métodos na prática.</p><p>A seguir, o <a href="/redux-toolkit/tutorials/advanced-tutorial">Tutorial avançado</a> examina como usar RTK em um aplicativo que busca dados assíncronos e usa TypeScript.</p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/redux-toolkit/tutorials/basic-tutorial"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Basic Tutorial</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/redux-toolkit/tutorials/advanced-tutorial"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Advanced Tutorial »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#revisando-o-exemplo-redux-todos" class="table-of-contents__link">Revisando o exemplo Redux Todos</a></li><li><a href="#etapas-de-conversão-inicial" class="table-of-contents__link">Etapas de conversão inicial</a><ul><li><a href="#adicionando-redux-toolkit-ao-projeto" class="table-of-contents__link">Adicionando Redux Toolkit ao projeto</a></li><li><a href="#convertendo-a-store-para-usar-configurestore" class="table-of-contents__link">Convertendo a store para usar <code>configureStore</code></a></li></ul></li><li><a href="#criando-o-todos-slice" class="table-of-contents__link">Criando o Todos Slice</a><ul><li><a href="#entendendo-slices" class="table-of-contents__link">Entendendo Slices</a></li><li><a href="#examinando-o-reducer-de-todos-original" class="table-of-contents__link">Examinando o reducer de todos original</a></li><li><a href="#escrevendo-o-slice-reducer" class="table-of-contents__link">Escrevendo o slice reducer</a></li><li><a href="#atualizando-os-testes-todos" class="table-of-contents__link">Atualizando os Testes Todos</a></li><li><a href="#implementando-ids-de-todo" class="table-of-contents__link">Implementando IDs de Todo</a></li></ul></li><li><a href="#usando-o-novo-slice-de-todos" class="table-of-contents__link">Usando o Novo Slice de Todos</a><ul><li><a href="#atualizando-o-reducer-raiz" class="table-of-contents__link">Atualizando o reducer raiz</a></li><li><a href="#atualizando-o-componente-add-todo" class="table-of-contents__link">Atualizando o componente Add Todo</a></li><li><a href="#atualizando-a-lista-de-todos" class="table-of-contents__link">Atualizando a lista de todos</a></li></ul></li><li><a href="#criando-e-usando-o-slice-de-filtros" class="table-of-contents__link">Criando e usando o slice de filtros</a><ul><li><a href="#escrevendo-o-slice-de-filtros" class="table-of-contents__link">Escrevendo o slice de filtros</a></li><li><a href="#usando-a-slice-de-filtros" class="table-of-contents__link">Usando a Slice de filtros</a></li></ul></li><li><a href="#otimizando-a-filtragem-de-todo" class="table-of-contents__link">Otimizando a filtragem de todo</a></li><li><a href="#cleanup" class="table-of-contents__link">Cleanup</a></li><li><a href="#resumo" class="table-of-contents__link">Resumo</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/redux-toolkit/introduction/quick-start">Começo rápido</a></li><li class="footer__item"><a class="footer__link-item" href="/redux-toolkit/api/configureStore">Referência de API</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Comunidade</h4><ul class="footer__items"><li class="footer__item"><a href="http://stackoverflow.com/questions/tagged/redux" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://discord.gg/0ZcbPKXt5bZ6au5t" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Mais</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.github.com/reduxjs/redux-toolkit" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item">
                <a href="https://www.netlify.com">
                  <img src="https://www.netlify.com/img/global/badges/netlify-light.svg" alt="Deploys by Netlify">
                </a>
              </li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><img class="footer__logo" alt="Redux Logo" src="/redux-toolkit/img/redux_white.svg"></div><div>Direito autoral © 2015–2021 Dan Abramov and the Redux documentation authors.</div></div></div></footer></div>
<script src="/redux-toolkit/styles.8e2df2eb.js"></script>
<script src="/redux-toolkit/runtime~main.f2ffa899.js"></script>
<script src="/redux-toolkit/main.8855d00d.js"></script>
<script src="/redux-toolkit/1.57fadc6f.js"></script>
<script src="/redux-toolkit/2.ffe88765.js"></script>
<script src="/redux-toolkit/27.ed6da2e2.js"></script>
<script src="/redux-toolkit/30.fc892cc4.js"></script>
<script src="/redux-toolkit/f976f453.b05aa0e0.js"></script>
<script src="/redux-toolkit/17896441.8e146be0.js"></script>
<script src="/redux-toolkit/0fdf4150.60d954f6.js"></script>
</body>
</html>