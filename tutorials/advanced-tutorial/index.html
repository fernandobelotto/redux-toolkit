<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.64">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-130598673-3","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="Redux Toolkit" href="/redux-toolkit/opensearch.xml"><title data-react-helmet="true">Advanced Tutorial | Redux Toolkit</title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" property="og:image" content="https://fernandobelotto.github.io/redux-toolkit/img/redux-logo-landscape.png"><meta data-react-helmet="true" property="twitter:image" content="https://fernandobelotto.github.io/redux-toolkit/img/redux-logo-landscape.png"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for Redux Toolkit"><meta data-react-helmet="true" name="twitter:card" content="summary"><meta data-react-helmet="true" property="og:title" content="Advanced Tutorial | Redux Toolkit"><meta data-react-helmet="true" name="description" content="Tutorial avan√ßado: Redux Toolkit na pr√°tica"><meta data-react-helmet="true" property="og:description" content="Tutorial avan√ßado: Redux Toolkit na pr√°tica"><meta data-react-helmet="true" property="og:url" content="https://fernandobelotto.github.io/redux-toolkit/tutorials/advanced-tutorial"><link data-react-helmet="true" rel="shortcut icon" href="/redux-toolkit/img/favicon/favicon.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="true"><link data-react-helmet="true" rel="canonical" href="https://fernandobelotto.github.io/redux-toolkit/tutorials/advanced-tutorial"><link rel="stylesheet" href="/redux-toolkit/styles.4024d809.css">
<link rel="preload" href="/redux-toolkit/styles.eb99357f.js" as="script">
<link rel="preload" href="/redux-toolkit/runtime~main.68ebf52a.js" as="script">
<link rel="preload" href="/redux-toolkit/main.3d9f7115.js" as="script">
<link rel="preload" href="/redux-toolkit/1.57fadc6f.js" as="script">
<link rel="preload" href="/redux-toolkit/2.2b7db848.js" as="script">
<link rel="preload" href="/redux-toolkit/27.1911eaf1.js" as="script">
<link rel="preload" href="/redux-toolkit/30.fc892cc4.js" as="script">
<link rel="preload" href="/redux-toolkit/f976f453.bed7d5e1.js" as="script">
<link rel="preload" href="/redux-toolkit/17896441.4d650456.js" as="script">
<link rel="preload" href="/redux-toolkit/1d5ff78c.5acaff8d.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/redux-toolkit/"><img class="navbar__logo" src="/redux-toolkit/img/redux.svg" alt="Redux Logo"><strong class="navbar__title">Redux Toolkit</strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/redux-toolkit/introduction/quick-start">Come√ßo r√°pido</a><a class="navbar__item navbar__link" href="/redux-toolkit/api/configureStore">API</a><a href="https://github.com/reduxjs/redux-toolkit" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">üåû</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">‚åò</span><span class="DocSearch-Button-Key">K</span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/redux-toolkit/"><img class="navbar__logo" src="/redux-toolkit/img/redux.svg" alt="Redux Logo"><strong class="navbar__title">Redux Toolkit</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/redux-toolkit/introduction/quick-start">Come√ßo r√°pido</a></li><li class="menu__list-item"><a class="menu__link" href="/redux-toolkit/api/configureStore">API</a></li><li class="menu__list-item"><a href="https://github.com/reduxjs/redux-toolkit" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Introdu√ß√£o</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/redux-toolkit/introduction/quick-start">In√≠cio R√°pido</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Tutoriais</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/redux-toolkit/tutorials/basic-tutorial">Basic Tutorial</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/redux-toolkit/tutorials/intermediate-tutorial">Intermediate Tutorial</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/redux-toolkit/tutorials/advanced-tutorial">Advanced Tutorial</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Usando Redux Toolkit</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/redux-toolkit/usage/usage-guide">Usage Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/redux-toolkit/usage/usage-with-typescript">Usage With TypeScript</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Refer√™ncia de API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Store Setup</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/redux-toolkit/api/configureStore">configureStore</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/redux-toolkit/api/getDefaultMiddleware">getDefaultMiddleware</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/redux-toolkit/api/immutabilityMiddleware">Immutability Middleware</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/redux-toolkit/api/serializabilityMiddleware">Serializability Middleware</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Reducers and Actions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/redux-toolkit/api/createReducer">createReducer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/redux-toolkit/api/createAction">createAction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/redux-toolkit/api/createSlice">createSlice</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/redux-toolkit/api/createAsyncThunk">createAsyncThunk</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/redux-toolkit/api/createEntityAdapter">createEntityAdapter</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Other</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/redux-toolkit/api/createSelector">createSelector</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/redux-toolkit/api/matching-utilities">Matching Utilities</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/redux-toolkit/api/other-exports">Other Exports</a></li></ul></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><div class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="tutorial-avan√ßado-redux-toolkit-na-pr√°tica"></a>Tutorial avan√ßado: Redux Toolkit na pr√°tica<a aria-hidden="true" tabindex="-1" class="hash-link" href="#tutorial-avan√ßado-redux-toolkit-na-pr√°tica" title="Direct link to heading">#</a></h1><p>In the <a href="/redux-toolkit/tutorials/intermediate-tutorial">Intermediate Tutorial</a>, you saw how to use Redux Toolkit in a typical basic React app, as well as how to convert some existing plain Redux code to use RTK instead. You also saw how to write &quot;mutative&quot; immutable updates in reducer functions, and how to write a &quot;prepare callback&quot; to generate an action payload.</p><p>In this tutorial, you&#x27;ll see how to use Redux Toolkit as part of a larger &quot;real world&quot; app that is bigger than a todo list example. This tutorial will show several concepts:</p><ul><li>How to convert a &quot;plain React&quot; app to use Redux</li><li>How async logic like data fetching fits into RTK</li><li>How to use RTK with TypeScript</li></ul><p>In the process, we&#x27;ll look at a few examples of TypeScript techniques you can use to improve your code, and we&#x27;ll see how to use the new <a href="https://react-redux.js.org/api/hooks" target="_blank" rel="noopener noreferrer">React-Redux hooks APIs</a> as an alternative to <a href="https://react-redux.js.org/api/connect" target="_blank" rel="noopener noreferrer">the traditional <code>connect</code> API</a>.</p><blockquote><p><strong>Note</strong>: This is not a complete tutorial on how to use TypeScript in general or with Redux specifically, and the examples shown here do not try to achieve 100% complete type safety. For further information, please refer to community resources such as the <a href="https://github.com/typescript-cheatsheets/react" target="_blank" rel="noopener noreferrer">React TypeScript Cheatsheet</a> and the <a href="https://github.com/piotrwitek/react-redux-typescript-guide" target="_blank" rel="noopener noreferrer">React/Redux TypeScript Guide</a>.</p><p>In addition, this tutorial does not mean you <em>must</em> convert your React app logic completely to Redux. <a href="https://redux.js.org/faq/organizing-state#do-i-have-to-put-all-my-state-into-redux-should-i-ever-use-reacts-setstate" target="_blank" rel="noopener noreferrer">It&#x27;s up to you to decide what state should live in React components, and what should be in Redux</a>. This is just an example of how you <em>could</em> convert logic to use Redux if you choose to.</p></blockquote><p>The complete source code for the converted application from this tutorial is available at <a href="https://github.com/reduxjs/rtk-github-issues-example" target="_blank" rel="noopener noreferrer">github.com/reduxjs/rtk-github-issues-example</a>. We&#x27;ll be walking through the conversion process as shown in this repo&#x27;s history. Links to meaningful individual commits will be highlighted in quote blocks, like this:</p><blockquote><ul><li>Commit message here</li></ul></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="reviewing-the-starting-example-application"></a>Reviewing the Starting Example Application<a aria-hidden="true" tabindex="-1" class="hash-link" href="#reviewing-the-starting-example-application" title="Direct link to heading">#</a></h2><p>The example application for this tutorial is a Github Issues viewer app. It allows the user to enter the names of a Github org and repository, fetch the current list of open issues, page through the issues list, and view the contents and comments of a specific issue.</p><p>The starting commit for this application is a plain React implementation that uses function components with hooks for state and side effects like data fetching. The code is already written in TypeScript, and the styling is done via CSS Modules.</p><p>Let&#x27;s start by viewing the original plain React app in action:</p><iframe src="https://codesandbox.io/embed/rsk-github-issues-example-8jf6d?fontsize=14&amp;hidenavigation=1&amp;theme=dark&amp;view=preview" style="width:100%;height:500px;border:0;border-radius:4px;overflow:hidden" title="rtk-github-issues-example-01-plain-react" allow="geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media; usb" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="react-codebase-source-overview"></a>React Codebase Source Overview<a aria-hidden="true" tabindex="-1" class="hash-link" href="#react-codebase-source-overview" title="Direct link to heading">#</a></h3><p>The codebase is already laid out in a &quot;feature folder&quot; structure, The main pieces are:</p><ul><li><code>/api</code>: fetching functions and TS types for the Github Issues API</li><li><code>/app</code>: main <code>&lt;App&gt;</code> component</li><li><code>/components</code>: components that are reused in multiple places</li><li><code>/features</code><ul><li><code>/issueDetails:</code> components for the Issue Details page</li><li><code>/issuesList</code>: components for the Issues List display</li><li><code>/repoSearch</code>: components for the Repo Search form</li></ul></li><li><code>/utils</code>: various string utility functions</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="setting-up-the-redux-store"></a>Setting Up the Redux Store<a aria-hidden="true" tabindex="-1" class="hash-link" href="#setting-up-the-redux-store" title="Direct link to heading">#</a></h2><p>Since this app doesn&#x27;t yet use Redux at all, the first step is to install Redux Toolkit and React-Redux. Since this is a TypeScript app, we&#x27;ll also need to add <code>@types/react-redux</code> as well. Add those packages to the project via either Yarn or NPM.</p><blockquote><ul><li><a href="https://github.com/reduxjs/rtk-github-issues-example/compare/Add_Redux_Toolkit_and_React-Redux_packages~1..reduxjs:Add_Redux_Toolkit_and_React-Redux_packages" target="_blank" rel="noopener noreferrer">Add Redux Toolkit and React-Redux packages</a></li></ul></blockquote><p>Next, we need to set up the usual pieces: a root reducer function, the Redux store, and the <code>&lt;Provider&gt;</code> to make that store available to our component tree.</p><p>In the process, we&#x27;re going to set up &quot;Hot Module Replacement&quot; for our app. That way, whenever we make a change to the reducer logic or the component tree, Create-React-App will rebuild the app and swap the changed code into our running app, without having to completely refresh the page.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="creating-the-root-reducer"></a>Creating the Root Reducer<a aria-hidden="true" tabindex="-1" class="hash-link" href="#creating-the-root-reducer" title="Direct link to heading">#</a></h4><blockquote><ul><li><a href="https://github.com/reduxjs/rtk-github-issues-example/compare/Add_store_and_root_reducer_with_reducer_HMR~1..reduxjs:Add_store_and_root_reducer_with_reducer_HMR" target="_blank" rel="noopener noreferrer">Add store and root reducer with reducer HMR</a></li></ul></blockquote><p>First, we&#x27;ll create the root reducer function. We don&#x27;t have any slices yet, so it will just return an empty object.</p><p>However, we&#x27;re going to want to know what the TypeScript type is for that root state object, because we need to declare what the type of the <code>state</code> variable is whenever our code needs to access the Redux store state (such as in <code>mapState</code> functions, <code>useSelector</code> selectors, and <code>getState</code> in thunks).</p><p>We could manually write a TS type with the correct types for each state slice, but we&#x27;d have to keep updating that type every time we make any change to the state structure in our slices. Fortunately, TS is usually pretty good at inferring types from the code we&#x27;ve already written. In this case, we can define a type that says &quot;this type is whatever gets returned from <code>rootReducer</code>&quot;, and TS will automatically figure out whatever that contains as the code is changed. If we export that type, other parts of the app can use it, and we know that it&#x27;s up to date. All we have to do is use the built-in TS <code>ReturnType</code> utility type, and feed in &quot;the type of the <code>rootReducer</code> function&quot; as its generic argument.</p><p><strong>app/rootReducer.ts</strong></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-ts codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> combineReducers </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;@reduxjs/toolkit&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> rootReducer </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">combineReducers</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">type</span><span class="token plain"> </span><span class="token maybe-class-name">RootState</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token maybe-class-name">ReturnType</span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token keyword" style="color:#F92672">typeof</span><span class="token plain"> rootReducer</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">default</span><span class="token plain"> rootReducer</span></div></div></div></div></div><blockquote><p><strong>Note:</strong> For other ways to infer the <code>RootState</code>, view the <a href="/redux-toolkit/usage/usage-with-typescript#getting-the-state-type">Usage with TypeScript</a> guide</p></blockquote><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="store-setup-and-hmr"></a>Store Setup and HMR<a aria-hidden="true" tabindex="-1" class="hash-link" href="#store-setup-and-hmr" title="Direct link to heading">#</a></h4><p>Next, we&#x27;ll create the store instance, including hot-reloading the root reducer. By using the <a href="https://webpack.js.org/concepts/hot-module-replacement/" target="_blank" rel="noopener noreferrer"><code>module.hot</code> API for reloading</a>, we can re-import the new version of the root reducer function whenever it&#x27;s been recompiled, and tell the store to use the new version instead.</p><p><strong>app/store.ts</strong></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-ts codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> configureStore </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;@reduxjs/toolkit&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">import</span><span class="token plain"> rootReducer </span><span class="token keyword" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;./rootReducer&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> store </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">configureStore</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  reducer</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> rootReducer</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">process</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">env</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token constant" style="color:#F92672">NODE_ENV</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">===</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;development&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">&amp;&amp;</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">module</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">hot</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">module</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">hot</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">accept</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;./rootReducer&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> newRootReducer </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">require</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;./rootReducer&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token keyword" style="color:#F92672">default</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    store</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">replaceReducer</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">newRootReducer</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">type</span><span class="token plain"> </span><span class="token maybe-class-name">AppDispatch</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">typeof</span><span class="token plain"> store</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">dispatch</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">default</span><span class="token plain"> store</span></div></div></div></div></div><p>The <code>require(&#x27;./rootReducer&#x27;).default</code> looks a bit odd. That&#x27;s because we&#x27;re mixing CommonJS synchronous import syntax with ES modules, so the &quot;default export&quot; is in a object field called <code>default</code>. We could probably also have used <code>import()</code> and handled the reducer replacement asynchronously as well.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="rendering-the-provider"></a>Rendering the <code>Provider</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#rendering-the-provider" title="Direct link to heading">#</a></h4><p>Now that the store has been created, we can add it to the React component tree.</p><blockquote><ul><li><a href="https://github.com/reduxjs/rtk-github-issues-example/compare/Render_Redux_Provider_with_app_HMR~1..reduxjs:Render_Redux_Provider_with_app_HMR" target="_blank" rel="noopener noreferrer">Render Redux Provider with app HMR</a></li></ul></blockquote><p>As with the root reducer, we can hot-reload the React component tree whenever a component file changes. The best way is to write a function that imports the <code>&lt;App&gt;</code> component and renders it, call that once on startup to show the React component tree as usual, and then reuse that function any time a component is changed.</p><p><strong>index.tsx</strong></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-tsx codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">import</span><span class="token plain"> </span><span class="token maybe-class-name">React</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;react&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">import</span><span class="token plain"> </span><span class="token maybe-class-name">ReactDOM</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;react-dom&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token maybe-class-name">Provider</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;react-redux&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">import</span><span class="token plain"> store </span><span class="token keyword" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;./app/store&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">import</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;./index.css&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">render</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token maybe-class-name">App</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">require</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;./app/App&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token keyword" style="color:#F92672">default</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token maybe-class-name">ReactDOM</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token function" style="color:#E6D874">render</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token tag punctuation" style="color:#F8F8F2">&lt;</span><span class="token tag class-name" style="color:#F92672">Provider</span><span class="token tag" style="color:#F92672"> </span><span class="token tag attr-name" style="color:#a6e22e">store</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#F8F8F2">=</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">{</span><span class="token tag script language-javascript" style="color:#F92672">store</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">}</span><span class="token tag punctuation" style="color:#F8F8F2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token tag punctuation" style="color:#F8F8F2">&lt;</span><span class="token tag class-name" style="color:#F92672">App</span><span class="token tag" style="color:#F92672"> </span><span class="token tag punctuation" style="color:#F8F8F2">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token tag punctuation" style="color:#F8F8F2">&lt;/</span><span class="token tag class-name" style="color:#F92672">Provider</span><span class="token tag punctuation" style="color:#F8F8F2">&gt;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token dom variable" style="color:#F8F8F2">document</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token function" style="color:#E6D874">getElementById</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;root&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#E6D874">render</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">process</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token plain">env</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token constant" style="color:#F92672">NODE_ENV</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">===</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;development&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">&amp;&amp;</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">module</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token plain">hot</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">module</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token plain">hot</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token function" style="color:#E6D874">accept</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;./app/App&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> render</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="converting-the-main-app-display"></a>Converting the Main App Display<a aria-hidden="true" tabindex="-1" class="hash-link" href="#converting-the-main-app-display" title="Direct link to heading">#</a></h2><p>With the main store setup done, we can now start converting the actual app logic to use Redux.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="evaluating-the-existing-app-state"></a>Evaluating the Existing App State<a aria-hidden="true" tabindex="-1" class="hash-link" href="#evaluating-the-existing-app-state" title="Direct link to heading">#</a></h3><p>Currently, the top-level &lt;<code>App&gt;</code> component uses React <code>useState</code> hooks to store several pieces of info:</p><ul><li>The selected Github org and repo</li><li>The current issues list page number</li><li>Whether we&#x27;re viewing the issues list, or the details for a specific issue</li></ul><p>Meanwhile, the <code>&lt;RepoSearchForm&gt;</code> component also uses state hooks to store the work-in-progress values for the controlled form inputs.</p><p>The Redux FAQ has <a href="https://redux.js.org/faq/organizing-state#do-i-have-to-put-all-my-state-into-redux-should-i-ever-use-reacts-setstate" target="_blank" rel="noopener noreferrer">some rules of thumb on when it makes sense to put data into Redux</a>. In this case, it&#x27;s reasonable to extract the state values from <code>&lt;App&gt;</code> and put those into the Redux store. While there&#x27;s only one component that uses them now, a larger app might have multiple components that care about those values. Since we&#x27;ve set up HMR, it would also be helpful to persist those values if we make future edits to the component tree.</p><p>On the other hand, while we <em>could</em> put the WIP form values into the Redux store, there&#x27;s no real benefit to doing so. Only the <code>&lt;RepoSearchForm&gt;</code> component cares about those values, and none of the other rules of thumb apply here. In general, <a href="https://redux.js.org/faq/organizing-state#should-i-put-form-state-or-other-ui-state-in-my-store" target="_blank" rel="noopener noreferrer">most form state probably shouldn&#x27;t be kept in Redux</a>. So, we&#x27;ll leave that alone.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="creating-the-initial-state-slices"></a>Creating the Initial State Slices<a aria-hidden="true" tabindex="-1" class="hash-link" href="#creating-the-initial-state-slices" title="Direct link to heading">#</a></h3><p>The first step is to look at the data that is currently being kept in <code>&lt;App&gt;</code>, and turn that into the types and initial state values for our &quot;issues display&quot; slice. From there, we can define reducers to update them appropriately.</p><p>Let&#x27;s look at the source for the whole slice, and then break down what it&#x27;s doing:</p><blockquote><ul><li><a href="https://github.com/reduxjs/rtk-github-issues-example/compare/Add_initial_state_slice_for_UI_display~1..reduxjs:Add_initial_state_slice_for_UI_display" target="_blank" rel="noopener noreferrer">Add initial state slice for UI display</a></li></ul></blockquote><p><strong>features/issuesDisplay/issuesDisplaySlice.ts</strong></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-ts codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> createSlice</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token maybe-class-name">PayloadAction</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;@reduxjs/toolkit&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">interface</span><span class="token plain"> </span><span class="token class-name">CurrentDisplay</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  displayType</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;issues&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">|</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;comments&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  issueId</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#a6e22e">number</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">|</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">null</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">interface</span><span class="token plain"> </span><span class="token class-name">CurrentDisplayPayload</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  displayType</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;issues&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">|</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;comments&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  issueId</span><span class="token operator" style="color:#F8F8F2">?</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#a6e22e">number</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">interface</span><span class="token plain"> </span><span class="token class-name">CurrentRepo</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  org</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#a6e22e">string</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  repo</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#a6e22e">string</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">type</span><span class="token plain"> </span><span class="token maybe-class-name">CurrentDisplayState</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  page</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#a6e22e">number</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">&amp;</span><span class="token plain"> </span><span class="token maybe-class-name">CurrentDisplay</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">&amp;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token maybe-class-name">CurrentRepo</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">let</span><span class="token plain"> initialState</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token maybe-class-name">CurrentDisplayState</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  org</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;rails&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  repo</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;rails&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  page</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token number" style="color:#AE81FF">1</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  displayType</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;issues&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  issueId</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">null</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> issuesDisplaySlice </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">createSlice</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  name</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;issuesDisplay&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  initialState</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  reducers</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">displayRepo</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> action</span><span class="token parameter punctuation" style="color:#F8F8F2">:</span><span class="token parameter"> PayloadAction</span><span class="token parameter operator" style="color:#F8F8F2">&lt;</span><span class="token parameter">CurrentRepo</span><span class="token parameter operator" style="color:#F8F8F2">&gt;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> org</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> repo </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">payload</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">org</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> org</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">repo</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> repo</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">setCurrentPage</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> action</span><span class="token parameter punctuation" style="color:#F8F8F2">:</span><span class="token parameter"> PayloadAction</span><span class="token parameter operator" style="color:#F8F8F2">&lt;</span><span class="token parameter">number</span><span class="token parameter operator" style="color:#F8F8F2">&gt;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">page</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">payload</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">setCurrentDisplayType</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> action</span><span class="token parameter punctuation" style="color:#F8F8F2">:</span><span class="token parameter"> PayloadAction</span><span class="token parameter operator" style="color:#F8F8F2">&lt;</span><span class="token parameter">CurrentDisplayPayload</span><span class="token parameter operator" style="color:#F8F8F2">&gt;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> displayType</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> issueId </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">null</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">payload</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">displayType</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> displayType</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">issueId</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> issueId</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  displayRepo</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  setCurrentDisplayType</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  setCurrentPage</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> issuesDisplaySlice</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">actions</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">default</span><span class="token plain"> issuesDisplaySlice</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">reducer</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="state-contents-type-declarations"></a>State Contents Type Declarations<a aria-hidden="true" tabindex="-1" class="hash-link" href="#state-contents-type-declarations" title="Direct link to heading">#</a></h4><p>The org and repo values are simple strings, and the current issues page is just a number. We will use a union of string constants to indicate if we&#x27;re showing the issues list or the details of a single issue, and if it&#x27;s the details, we need to know the issue ID number.</p><p>We can define types for a couple of those pieces by themselves for reuse in the action types later, and also combine them into a larger type for the entire state we plan to track.</p><p>The &quot;current display&quot; part requires a bit of extra work, because the type listed for the state includes a page number, but the UI won&#x27;t include one when it dispatches an action to switch to the issues list. So, we define a separate type for that action&#x27;s contents.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="declaring-types-for-slice-state-and-actions"></a>Declaring Types for Slice State and Actions<a aria-hidden="true" tabindex="-1" class="hash-link" href="#declaring-types-for-slice-state-and-actions" title="Direct link to heading">#</a></h4><p><code>createSlice</code> tries to infer types from two sources:</p><ul><li>The state type is based on the type of the <code>initialState</code> field</li><li>Each reducer needs to declare the type of the action it expects to handle</li></ul><p>The state type is used as the type for the <code>state</code> parameter in each of the case reducers and the return type for the generated reducer function, and the action types are used for the corresponding generated action creators. (Alternately, if you define a &quot;prepare callback&quot; alongside a reducer, the prepare callback&#x27;s arguments are used for the action creator too, and the return value from the callback must match the declared type for the action the reducer expects.)</p><p>The main type you will use when declaring action types in reducers is <strong><code>PayloadAction&lt;PayloadType&gt;</code></strong>. <code>createAction</code> uses this type as its return value.</p><p>Let&#x27;s look at a specific reducer as an example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-ts codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#E6D874">setCurrentPage</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> action</span><span class="token parameter punctuation" style="color:#F8F8F2">:</span><span class="token parameter"> PayloadAction</span><span class="token parameter operator" style="color:#F8F8F2">&lt;</span><span class="token parameter">number</span><span class="token parameter operator" style="color:#F8F8F2">&gt;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">page</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">payload</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">,</span></div></div></div></div></div><p>We don&#x27;t have to declare a type for <code>state</code>, because <code>createSlice</code> already knows that this should be the same type as our <code>initialState</code>: the <code>CurrentDisplayState</code> type.</p><p>We declare that the action object is a <code>PayloadAction</code>, where <code>action.payload</code> is a <code>number</code>. Then, when we assign <code>state.page = action.payload</code>, TS knows that we&#x27;re assigning a number to a number, and it works correctly. If we were to try calling <code>issuesDisplaySlice.actions.setCurrentPage()</code>, we would need to pass a number in as the argument, because that number will become the payload in the action.</p><p>Similarly, for <code>displayRepo(state, action: PayloadAction&lt;CurrentRepo&gt;)</code>, TS knows that <code>action.payload</code> is an object with <code>org</code> and <code>repo</code> string fields, and we can assign them to the state. (Remember that these &quot;mutative&quot; assignments are only safe and possible because <code>createSlice</code> uses Immer inside!)</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="using-the-slice-reducer"></a>Using the Slice Reducer<a aria-hidden="true" tabindex="-1" class="hash-link" href="#using-the-slice-reducer" title="Direct link to heading">#</a></h4><p>As with other examples, we then need to import and add the issues display slice reducer to our root reducer:</p><p><strong>app/rootReducer.ts</strong></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-diff codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token plain">import { combineReducers } from &#x27;@reduxjs/toolkit&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+import issuesDisplayReducer from &#x27;features/issuesDisplay/issuesDisplaySlice&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token deleted-sign deleted" style="color:#F92672">-const rootReducer = combineReducers({})</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+const rootReducer = combineReducers({</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+ issuesDisplay: issuesDisplayReducer</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+})</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="converting-the-issues-display"></a>Converting the Issues Display<a aria-hidden="true" tabindex="-1" class="hash-link" href="#converting-the-issues-display" title="Direct link to heading">#</a></h3><p>Now that the issues display slice is hooked up to the store, we can update <code>&lt;App&gt;</code> to use that instead of its internal component state.</p><blockquote><ul><li><a href="https://github.com/reduxjs/rtk-github-issues-example/compare/Convert_main_issues_display_control_to_Redux~1..reduxjs:Convert_main_issues_display_control_to_Redux" target="_blank" rel="noopener noreferrer">Convert main issues display control to Redux</a></li></ul></blockquote><p>We need to make three groups of changes to the <code>App</code> component:</p><ul><li>The <code>useState</code> declarations need to be removed</li><li>The corresponding state values need to be read from the Redux store</li><li>Redux actions need to be dispatched as the user interacts with the component</li></ul><p>Traditionally, the last two aspects would be handled via the <a href="https://react-redux.js.org/api/connect" target="_blank" rel="noopener noreferrer">React-Redux <code>connect</code> API</a>. We&#x27;d write a <code>mapState</code> function to retrieve the data and a <code>mapDispatch</code> function to hold the action creators, pass those to <code>connect</code>, get everything as props, and then call <code>this.props.setCurrentPage()</code> to dispatch that action type.</p><p>However, <a href="https://react-redux.js.org/api/hooks" target="_blank" rel="noopener noreferrer">React-Redux now has a hooks API</a>, which allows us to interact with the store more directly. <code>useSelector</code> lets us read data from the store and subscribe to updates, and <code>useDispatch</code> gives us a reference to the store&#x27;s <code>dispatch</code> method. We&#x27;ll use those throughout the rest of this tutorial.</p><p>First, we&#x27;ll import the necessary functions, plus the <code>RootState</code> type we declared earlier, and remove the hardcoded default org and repo strings.</p><p><strong>app/App.tsx</strong></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-diff codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token plain">import React, { useState } from &#x27;react&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+import { useSelector, useDispatch } from &#x27;react-redux&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+import { RootState } from &#x27;./rootReducer&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">import { RepoSearchForm } from &#x27;features/repoSearch/RepoSearchForm&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">import { IssuesListPage } from &#x27;features/issuesList/IssuesListPage&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">import { IssueDetailsPage } from &#x27;features/issueDetails/IssueDetailsPage&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token deleted-sign deleted" style="color:#F92672">-const ORG = &#x27;rails&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-const REPO = &#x27;rails&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+import {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+  displayRepo,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+  setCurrentDisplayType,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+  setCurrentPage</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+} from &#x27;features/issuesDisplay/issuesDisplaySlice&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">import &#x27;./App.css&#x27;</span></div></div></div></div></div><p>Next, at the top of <code>App</code>, we&#x27;ll remove the old <code>useState</code> hooks, and replace them with a call to <code>useDispatch</code> and <code>useSelector</code>:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-diff codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token plain">const App: React.FC = () =&gt; {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token deleted-sign deleted" style="color:#F92672">- const [org, setOrg] = useState(ORG)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">- const [repo, setRepo] = useState(REPO)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">- const [page, setPage] = useState(1)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">- const [currentDisplay, setCurrentDisplay] = useState&lt;CurrentDisplay&gt;({</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-   type: &#x27;issues&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">- })</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+ const dispatch = useDispatch()</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+ const { org, repo, displayType, page, issueId } = useSelector(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+   (state: RootState) =&gt; state.issuesDisplay</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+ )</span></div></div></div></div></div><p>We pass a &quot;selector&quot; function into <code>useSelector</code>, which is just a function that accepts our Redux store state as its parameter and returns some result. We declare that the type of the <code>state</code> argument is the <code>RootState</code> type we defined over in the root reducer, so that TS knows what fields are inside <code>state</code>. We can retrieve the <code>state.issuesDisplay</code> slice as one piece, and destructure the result object into multiple variables inside the component.</p><p>We now have mostly the same data variables inside the component as we did before - they&#x27;re just coming from the Redux store instead of <code>useState</code> hooks.</p><p>The last step is to dispatch Redux actions whenever the user does something, instead of calling the <code>useState</code> setters:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-diff codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">  const setOrgAndRepo = (org: string, repo: string) =&gt; {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged"></span><span class="token deleted-sign deleted" style="color:#F92672">-   setOrg(org)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-   setRepo(repo)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+   dispatch(displayRepo({ org, repo }))</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token unchanged">  }</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token unchanged">  const setJumpToPage = (page: number) =&gt; {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged"></span><span class="token deleted-sign deleted" style="color:#F92672">-   setPage(page)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+   dispatch(setCurrentPage(page))</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token unchanged">  }</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token unchanged">  const showIssuesList = () =&gt; {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged"></span><span class="token deleted-sign deleted" style="color:#F92672">-   setCurrentDisplay({ type: &#x27;issues&#x27; })</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+   dispatch(setCurrentDisplayType({ displayType: &#x27;issues&#x27; }))</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token unchanged">  }</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token unchanged">  const showIssueComments = (issueId: number) =&gt; {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged"></span><span class="token deleted-sign deleted" style="color:#F92672">-   setCurrentDisplay({ type: &#x27;comments&#x27;, issueId })</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+   dispatch(setCurrentDisplayType({ displayType: &#x27;comments&#x27;, issueId }))</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token unchanged">  }</span></div></div></div></div></div><p>Unlike typical <code>connect</code> + <code>mapDispatch</code> usage, here we call <code>dispatch()</code> directly, and do so by calling an action creator with the correct <code>payload</code> value and passing the resulting action to <code>dispatch</code>.</p><p>Let&#x27;s see if this works!</p><iframe src="https://codesandbox.io/embed/rtk-github-issues-example-02-issues-display-tdx2w?fontsize=14&amp;hidenavigation=1&amp;module=%2Fsrc%2Fapp%2FApp.tsx&amp;theme=dark&amp;view=preview" style="width:100%;height:500px;border:0;border-radius:4px;overflow:hidden" title="rtk-github-issues-example-02-issues-display" allow="geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media; usb" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe><p>If you&#x27;re thinking &quot;hey, this looks and behaves exactly like the previous example&quot;... then that&#x27;s great! That means we&#x27;ve correctly converted the first bit of logic to Redux so far. If you want to confirm that there&#x27;s Redux logic running, try clicking the &quot;Open in New Window&quot; button and inspect the store in the Redux DevTools Extension.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="converting-the-issues-list-page"></a>Converting the Issues List Page<a aria-hidden="true" tabindex="-1" class="hash-link" href="#converting-the-issues-list-page" title="Direct link to heading">#</a></h2><p>Our next task is to convert the <code>&lt;IssuesListPage&gt;</code> component to fetch and store issues via Redux. Currently, <code>&lt;IssuesListPage&gt;</code> is storing all data in <code>useState</code> hooks, including the fetched issues. It fetches the issues by making an AJAX call in a <code>useEffect</code> hook.</p><p>As mentioned at the start, there&#x27;s nothing actually wrong with this! Having React components fetch and store their own data is totally fine. But, for the purposes of this tutorial, we want to see how the Redux conversion process looks.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="reviewing-the-issues-list-component"></a>Reviewing the Issues List Component<a aria-hidden="true" tabindex="-1" class="hash-link" href="#reviewing-the-issues-list-component" title="Direct link to heading">#</a></h3><p>Here&#x27;s the initial chunk of <code>&lt;IssuesListPage&gt;</code>:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-ts codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color:#E6D874">IssuesListPage</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter punctuation" style="color:#F8F8F2">{</span><span class="token parameter"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token parameter">  org</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token parameter">  repo</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token parameter">  page </span><span class="token parameter operator" style="color:#F8F8F2">=</span><span class="token parameter"> </span><span class="token parameter number" style="color:#AE81FF">1</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token parameter">  setJumpToPage</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token parameter">  showIssueComments</span></div><div class="token-line" style="color:#f8f8f2"><span class="token parameter"></span><span class="token parameter punctuation" style="color:#F8F8F2">}</span><span class="token parameter punctuation" style="color:#F8F8F2">:</span><span class="token parameter"> ILProps</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token plain">issuesResult</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> setIssues</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> useState</span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token maybe-class-name">IssuesResult</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    pageLinks</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">null</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    pageCount</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token number" style="color:#AE81FF">1</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    issues</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token plain">numIssues</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> setNumIssues</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> useState</span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token builtin" style="color:#a6e22e">number</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token operator" style="color:#F8F8F2">-</span><span class="token number" style="color:#AE81FF">1</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token plain">isLoading</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> setIsLoading</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> useState</span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token builtin" style="color:#a6e22e">boolean</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token boolean" style="color:#AE81FF">false</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token plain">issuesError</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> setIssuesError</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> useState</span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token known-class-name class-name">Error</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">|</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">null</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token keyword" style="color:#F92672">null</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> issues</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> pageCount </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> issuesResult</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#E6D874">useEffect</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">async</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">fetchEverything</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#F92672">async</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">fetchIssues</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> issuesResult </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">await</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">getIssues</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">org</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> repo</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> page</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token function" style="color:#E6D874">setIssues</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">issuesResult</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#F92672">async</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">fetchIssueCount</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> repoDetails </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">await</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">getRepoDetails</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">org</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> repo</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token function" style="color:#E6D874">setNumIssues</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">repoDetails</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">open_issues_count</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#F92672">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#F92672">await</span><span class="token plain"> </span><span class="token known-class-name class-name">Promise</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">all</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token function" style="color:#E6D874">fetchIssues</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">fetchIssueCount</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token function" style="color:#E6D874">setIssuesError</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token keyword" style="color:#F92672">null</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">error</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token function" style="color:#E6D874">setIssuesError</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token function" style="color:#E6D874">setIsLoading</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token boolean" style="color:#AE81FF">false</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">setIsLoading</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token boolean" style="color:#AE81FF">true</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">fetchEverything</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token plain">org</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> repo</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> page</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#778090">// omit rendering</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span></div></div></div></div></div><p>The <code>useEffect</code> callback defines an outer <code>async function fetchEverything()</code> and calls it immediately. This is because we can&#x27;t declare the <code>useEffect</code> callback itself as async. React expects that the return value from a <code>useEffect</code> callback will be a cleanup function. Since all async functions return a <code>Promise</code> automatically, React would see that <code>Promise</code> instead, and that would prevent React from actually cleaning up correctly.</p><p>Inside, we define two more async functions to fetch issues and the open issues count, and call them both. We then wait for both functions to resolve successfully. (There&#x27;s a few other ways we could have organized this logic, but this was sufficient for the example.)</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="thinking-in-thunks"></a>Thinking in Thunks<a aria-hidden="true" tabindex="-1" class="hash-link" href="#thinking-in-thunks" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="what-is-a-thunk"></a>What is a &quot;Thunk&quot;?<a aria-hidden="true" tabindex="-1" class="hash-link" href="#what-is-a-thunk" title="Direct link to heading">#</a></h4><p>The Redux core (ie, <code>createStore</code>) is completely synchronous. When you call <code>store.dispatch()</code>, the store runs the root reducer, saves the return value, runs the subscriber callbacks, and returns, with no pause. By default, any asynchronicity has to happen outside of the store.</p><p>But, what if you want to have async logic interact with the store by dispatching or checking the current store state? That&#x27;s where <a href="https://redux.js.org/advanced/middleware" target="_blank" rel="noopener noreferrer">Redux middleware</a> come in. They extend the store, and allow you to:</p><ul><li>Execute extra logic when any action is dispatched (such as logging the action and state)</li><li>Pause, modify, delay, replace, or halt dispatched actions</li><li>Write extra code that has access to <code>dispatch</code> and <code>getState</code></li><li>Teach <code>dispatch</code> how to accept other values besides plain action objects, such as functions and promises, by intercepting them and dispatching real action objects instead</li></ul><p>The most common Redux middleware is <a href="https://github.com/reduxjs/redux-thunk" target="_blank" rel="noopener noreferrer"><code>redux-thunk</code></a>. The word &quot;thunk&quot; means &quot;a function that delays a calculation until later&quot;. In our case, adding the thunk middleware to our Redux store lets us pass functions directly to <code>store.dispatch()</code>. The thunk middleware will see the function, prevent it from actually reaching the &quot;real&quot; store, and call our function and pass in <code>dispatch</code> and <code>getState</code> as arguments. So, a &quot;thunk function&quot; looks like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-js codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">exampleThunkFunction</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">dispatch</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> getState</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#778090">// do something useful with dispatching or the store state here</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#778090">// normally an error, but okay if the thunk middleware is added</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">store</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">exampleThunkFunction</span><span class="token punctuation" style="color:#F8F8F2">)</span></div></div></div></div></div><p>Inside of a thunk function, you can write any code you want. The most common usage would be fetching some data via an AJAX call, and dispatching an action to load that data into the Redux store. The <code>async/await</code> syntax makes it easier to write thunks that do AJAX calls.</p><p>Normally, we don&#x27;t write action objects directly in our code - we use action creator functions to make them, and use them like <code>dispatch(addTodo())</code>. In the same way, we typically write &quot;thunk action creator&quot; functions that return the thunk functions, like:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-js codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">exampleThunk</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">return</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">exampleThunkFunction</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">dispatch</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> getState</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#778090">// do something useful with dispatching or the store state here</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#778090">// normally an error, but okay if the thunk middleware is added</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">store</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token function" style="color:#E6D874">exampleThunk</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="why-use-thunks"></a>Why Use Thunks?<a aria-hidden="true" tabindex="-1" class="hash-link" href="#why-use-thunks" title="Direct link to heading">#</a></h4><p>You might be wondering what the point of all this is. There&#x27;s a few reasons to use thunks:</p><ul><li>Thunks allow us to write reusable logic that interacts with <em>a</em> Redux store, but without needing to reference a specific store instance.</li><li>Thunks enable us to move more complex logic outside of our components</li><li>From a component&#x27;s point of view, it doesn&#x27;t care whether it&#x27;s dispatching a plain action or kicking off some async logic - it just calls <code>dispatch(doSomething())</code> and moves on.</li><li>Thunks can return values like promises, allowing logic inside the component to wait for something else to finish.</li></ul><p>For further explanations, see <a href="https://github.com/reduxjs/redux-thunk#why-do-i-need-this" target="_blank" rel="noopener noreferrer">these articles explaining thunks in the <code>redux-thunk</code> documentation</a>.</p><p>There are many other kinds of Redux middleware that add async capabilities. The most popular are <a href="https://redux-saga.js.org/" target="_blank" rel="noopener noreferrer"><code>redux-saga</code></a>, which uses generator functions, and <a href="https://redux-observable.js.org/" target="_blank" rel="noopener noreferrer"><code>redux-observable</code></a>, which uses RxJS observables. For some comparisons, see the <a href="https://redux.js.org/faq/actions#what-async-middleware-should-i-use-how-do-you-decide-between-thunks-sagas-observables-or-something-else" target="_blank" rel="noopener noreferrer">Redux FAQ entry on &quot;how do I choose an async middleware?&quot;</a>.</p><p>However, while sagas and observables are useful, most apps do not need the power and capabilities they provide. So, <strong>thunks are
the default recommended approach for writing async logic with Redux</strong>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="writing-thunks-in-redux-toolkit"></a>Writing Thunks in Redux Toolkit<a aria-hidden="true" tabindex="-1" class="hash-link" href="#writing-thunks-in-redux-toolkit" title="Direct link to heading">#</a></h4><p>Writing thunk functions requires that the <code>redux-thunk</code> middleware be added to the store as part of the setup process. Redux Toolkit&#x27;s <code>configureStore</code> function does automatically - <a href="/redux-toolkit/api/getDefaultMiddleware"><code>thunk</code> is one of the default middleware</a>.</p><p>However, Redux Toolkit does not currently provide any special functions or syntax for writing thunk functions. In particular, they cannot be defined as part of a <code>createSlice()</code> call. You have to write them separate from the reducer logic.</p><p>In a typical Redux app, thunk action creators are usually defined in an &quot;actions&quot; file, alongside the plain action creators. Thunks typically dispatch plain actions, such as <code>dispatch(dataLoaded(response.data))</code>.</p><p>Because we don&#x27;t have separate &quot;actions&quot; files, it makes sense to write these thunks directly in our &quot;slice&quot; files. That way, they have access to the plain action creators from the slice, and it&#x27;s easy to find where the thunk function lives.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="logic-for-fetching-github-repo-details"></a>Logic for Fetching Github Repo Details<a aria-hidden="true" tabindex="-1" class="hash-link" href="#logic-for-fetching-github-repo-details" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="adding-a-reusable-thunk-function-type"></a>Adding a Reusable Thunk Function Type<a aria-hidden="true" tabindex="-1" class="hash-link" href="#adding-a-reusable-thunk-function-type" title="Direct link to heading">#</a></h4><p>Since the thunk middleware is already set up, we don&#x27;t have to do any work there. However, the TypeScript types for thunks are kind of long and confusing, and we&#x27;d normally have to repeat the same type declaration for every thunk function we write.</p><p>Before we go any further, let&#x27;s add a type declaration we can reuse instead.</p><blockquote><ul><li><a href="https://github.com/reduxjs/rtk-github-issues-example/compare/Add_AppThunk_type~1..reduxjs:Add_AppThunk_type" target="_blank" rel="noopener noreferrer">Add AppThunk type</a></li></ul></blockquote><p><strong>app/store.ts</strong></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-diff codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-import { configureStore } from &#x27;@reduxjs/toolkit&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+import { configureStore, Action } from &#x27;@reduxjs/toolkit&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+import { ThunkAction } from &#x27;redux-thunk&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token deleted-sign deleted" style="color:#F92672">-import rootReducer from &#x27;./rootReducer&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+import rootReducer, { RootState } from &#x27;./rootReducer&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">export type AppDispatch = typeof store.dispatch</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+export type AppThunk = ThunkAction&lt;void, RootState, unknown, Action&lt;string&gt;&gt;</span></div></div></div></div></div><p>The <code>AppThunk</code> type declares that the &quot;action&quot; that we&#x27;re using is specifically a thunk function. The thunk is customized with some additional type parameters:</p><ol><li>Return value: the thunk doesn&#x27;t return anything</li><li>State type for <code>getState</code>: returns our <code>RootState</code> type</li><li>&quot;Extra argument&quot;: the thunk middleware can be customized to pass in an extra value, but we aren&#x27;t doing that in this app</li><li>Action types accepted by <code>dispatch</code>: any action whose <code>type</code> is a string.</li></ol><p>There are many cases where you would want different type settings here, but these are probably the most common settings. This way, we can avoid repeating that same type declaration every time we write a thunk.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="adding-the-repo-details-slice"></a>Adding the Repo Details Slice<a aria-hidden="true" tabindex="-1" class="hash-link" href="#adding-the-repo-details-slice" title="Direct link to heading">#</a></h4><p>Now that we have that type, we can write a slice of state for fetching details on a repo.</p><blockquote><ul><li><a href="https://github.com/reduxjs/rtk-github-issues-example/compare/Add_a_slice_for_storing_repo_details~1..reduxjs:Add_a_slice_for_storing_repo_details" target="_blank" rel="noopener noreferrer">Add a slice for storing repo details</a></li></ul></blockquote><p><strong>features/repoSearch/repoDetailsSlice.ts</strong></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-ts codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> createSlice</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token maybe-class-name">PayloadAction</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;@reduxjs/toolkit&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token maybe-class-name">AppThunk</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;app/store&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token maybe-class-name">RepoDetails</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> getRepoDetails </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;api/githubAPI&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">interface</span><span class="token plain"> </span><span class="token class-name">RepoDetailsState</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  openIssuesCount</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#a6e22e">number</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  error</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#a6e22e">string</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">|</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">null</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> initialState</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token maybe-class-name">RepoDetailsState</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  openIssuesCount</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">-</span><span class="token number" style="color:#AE81FF">1</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  error</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">null</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> repoDetails </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">createSlice</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  name</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;repoDetails&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  initialState</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  reducers</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">getRepoDetailsSuccess</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> action</span><span class="token parameter punctuation" style="color:#F8F8F2">:</span><span class="token parameter"> PayloadAction</span><span class="token parameter operator" style="color:#F8F8F2">&lt;</span><span class="token parameter">RepoDetails</span><span class="token parameter operator" style="color:#F8F8F2">&gt;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">openIssuesCount</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">open_issues_count</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">error</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">null</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">getRepoDetailsFailed</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> action</span><span class="token parameter punctuation" style="color:#F8F8F2">:</span><span class="token parameter"> PayloadAction</span><span class="token parameter operator" style="color:#F8F8F2">&lt;</span><span class="token parameter">string</span><span class="token parameter operator" style="color:#F8F8F2">&gt;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">openIssuesCount</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">-</span><span class="token number" style="color:#AE81FF">1</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">error</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">payload</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  getRepoDetailsSuccess</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  getRepoDetailsFailed</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> repoDetails</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">actions</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">default</span><span class="token plain"> repoDetails</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">reducer</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> fetchIssuesCount </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  org</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#a6e22e">string</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  repo</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#a6e22e">string</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token parameter">AppThunk</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">async</span><span class="token plain"> </span><span class="token parameter">dispatch</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> repoDetails </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">await</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">getRepoDetails</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">org</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> repo</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token function" style="color:#E6D874">getRepoDetailsSuccess</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">repoDetails</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token function" style="color:#E6D874">getRepoDetailsFailed</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">toString</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span></div></div></div></div></div><p>The first part of this should look straightforward. We declare our slice state shape, the initial state value, and write a slice with reducers that store the open issues count or an error string, then export the action creators and reducer.</p><p>Down at the bottom, we have our first data fetching thunk. The important things to notice here are:</p><ul><li><strong>The thunk is defined separately from the slice</strong>, since RTK currently has no special syntax for defining thunks as part of a slice.</li><li><strong>We declare the thunk action creator as an arrow function, and use the <code>AppThunk</code> type we just created.</strong> You can use either arrow functions or the <code>function</code> keyword to write thunk functions and thunk action creators, so we could also have written this as <code>function fetchIssuesCount() : AppThunk</code> instead.</li><li><strong>We use the <code>async/await</code> syntax for the thunk function itself.</strong> Again, this isn&#x27;t required, but <code>async/await</code> usually results in simpler code than nested Promise <code>.then()</code> chains.</li><li><strong>Inside the thunk, we dispatch the plain action creators that were generated by the <code>createSlice</code> call</strong>.</li></ul><p>While not shown, we also add the slice reducer to our root reducer.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="async-error-handling-logic-in-thunks"></a>Async Error Handling Logic in Thunks<a aria-hidden="true" tabindex="-1" class="hash-link" href="#async-error-handling-logic-in-thunks" title="Direct link to heading">#</a></h4><p>There is one potential flaw with the <code>fetchIssuesCount()</code> thunk as written. The <code>try/catch</code> block will currently catch any errors thrown
by <code>getRepoDetails()</code> (such as an actual failed AJAX call), but it will also catch any errors that occur inside the dispatch of <code>getRepoDetailsSuccess()</code>. In both cases, it will end up dispatch <code>getRepoDetailsFailed()</code>. This may not be the desired way to handle errors, as it might show a misleading reason for what the actual error was.</p><p>There are some possible ways to restructure the code to avoid this problem. First, the <code>await</code> could be switched to a standard promise chain, with separate callbacks passed in for the success and failure cases:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-js codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#E6D874">getRepoDetails</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">org</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> repo</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">then</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#778090">// success callback</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter">repoDetails</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token function" style="color:#E6D874">getRepoDetailsSuccess</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">repoDetails</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#778090">// error callback</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token function" style="color:#E6D874">getRepoDetailsFailed</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">toString</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">)</span></div></div></div></div></div><p>Or, the thunk could be rewritten to only dispatch if no errors were caught:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-ts codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token plain"> </span><span class="token keyword" style="color:#F92672">let</span><span class="token plain"> repoDetails</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    repoDetails </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">await</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">getRepoDetails</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">org</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> repo</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token function" style="color:#E6D874">getRepoDetailsFailed</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">toString</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">return</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token function" style="color:#E6D874">getRepoDetailsSuccess</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">repoDetails</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span></div></div></div></div></div><p>For sake of simplicity, we&#x27;ll stick with the logic as-is for the rest of the tutorial.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="fetching-repo-details-in-the-issues-list"></a>Fetching Repo Details in the Issues List<a aria-hidden="true" tabindex="-1" class="hash-link" href="#fetching-repo-details-in-the-issues-list" title="Direct link to heading">#</a></h3><p>Now that the repo details slice exists, we can use it in the <code>&lt;IssuesListPage&gt;</code> component.</p><blockquote><ul><li><a href="https://github.com/reduxjs/rtk-github-issues-example/compare/Update_IssuesListPage_to_fetch_repo_details_via_Redux~1..reduxjs:Update_IssuesListPage_to_fetch_repo_details_via_Redux" target="_blank" rel="noopener noreferrer">Update IssuesListPage to fetch repo details via Redux</a></li></ul></blockquote><p><strong>features/issuesList/IssuesListPage.tsx</strong></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-diff codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token plain">import React, { useState, useEffect } from &#x27;react&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+import { useSelector, useDispatch } from &#x27;react-redux&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token deleted-sign deleted" style="color:#F92672">-import { getIssues, getRepoDetails, IssuesResult } from &#x27;api/githubAPI&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+import { getIssues, IssuesResult } from &#x27;api/githubAPI&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+import { fetchIssuesCount } from &#x27;features/repoSearch/repoDetailsSlice&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+import { RootState } from &#x27;app/rootReducer&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">// omit code</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">export const IssuesListPage = ({</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token unchanged">  org,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">  repo,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">  page = 1,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">  setJumpToPage,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">  showIssueComments</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged"></span><span class="token plain">}: ILProps) =&gt; {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+ const dispatch = useDispatch()</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token unchanged">  const [issuesResult, setIssues] = useState&lt;IssuesResult&gt;({</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">    pageLinks: null,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">    pageCount: 1,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">    issues: []</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">  })</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged"></span><span class="token deleted-sign deleted" style="color:#F92672">- const [numIssues, setNumIssues] = useState&lt;number&gt;(-1)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token unchanged">  const [isLoading, setIsLoading] = useState&lt;boolean&gt;(false)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">  const [issuesError, setIssuesError] = useState&lt;Error | null&gt;(null)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+ const openIssueCount = useSelector(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+   (state: RootState) =&gt; state.repoDetails.openIssuesCount</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+ )</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token unchanged">  useEffect(() =&gt; {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">    async function fetchEverything() {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">      async function fetchIssues() {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">        const issuesResult = await getIssues(org, repo, page)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">        setIssues(issuesResult)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">      }</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token deleted-sign deleted" style="color:#F92672">-     async function fetchIssueCount() {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-       const repoDetails = await getRepoDetails(org, repo)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-       setNumIssues(repoDetails.open_issues_count)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-     }</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token unchanged">      try {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged"></span><span class="token deleted-sign deleted" style="color:#F92672">-       await Promise.all([fetchIssues(), fetchIssueCount()])</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+       await Promise.all([</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+         fetchIssues(),</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+         dispatch(fetchIssuesCount(org, repo))</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+       ])</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token unchanged">        setIssuesError(null)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">      } catch (err) {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">        console.error(err)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">        setIssuesError(err)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">      } finally {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">        setIsLoading(false)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">      }</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">    }</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token unchanged">    setIsLoading(true)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token unchanged">    fetchEverything()</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged"></span><span class="token deleted-sign deleted" style="color:#F92672">- }, [org, repo, page])</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+ }, [org, repo, page, dispatch])</span></div></div></div></div></div><p>In <code>&lt;IssuesListPage&gt;</code>, we import the new <code>fetchIssuesCount</code> thunk, and rewrite the component to read the open issues count value from the Redux store.</p><p>Inside our <code>useEffect</code>, we drop the <code>fetchIssueCount</code> function, and dispatch <code>fetchIssuesCount</code> instead.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="logic-for-fetching-issues-for-a-repo"></a>Logic for Fetching Issues for a Repo<a aria-hidden="true" tabindex="-1" class="hash-link" href="#logic-for-fetching-issues-for-a-repo" title="Direct link to heading">#</a></h3><p>Next up, we need to replace the logic for fetching a list of open issues.</p><blockquote><ul><li><a href="https://github.com/reduxjs/rtk-github-issues-example/compare/Add_a_slice_for_tracking_issues_state~1..reduxjs:Add_a_slice_for_tracking_issues_state" target="_blank" rel="noopener noreferrer">Add a slice for tracking issues state</a></li></ul></blockquote><p><strong>features/issuesList/issuesSlice.ts</strong></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-ts codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> createSlice</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token maybe-class-name">PayloadAction</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;@reduxjs/toolkit&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token maybe-class-name">Links</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;parse-link-header&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token maybe-class-name">Issue</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token maybe-class-name">IssuesResult</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> getIssue</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> getIssues </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;api/githubAPI&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token maybe-class-name">AppThunk</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;app/store&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">interface</span><span class="token plain"> </span><span class="token class-name">IssuesState</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  issuesByNumber</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token maybe-class-name">Record</span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token builtin" style="color:#a6e22e">number</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token maybe-class-name">Issue</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  currentPageIssues</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#a6e22e">number</span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  pageCount</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#a6e22e">number</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  pageLinks</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token maybe-class-name">Links</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">|</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">null</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  isLoading</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#a6e22e">boolean</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  error</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#a6e22e">string</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">|</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">null</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> issuesInitialState</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token maybe-class-name">IssuesState</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  issuesByNumber</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  currentPageIssues</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  pageCount</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token number" style="color:#AE81FF">0</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  pageLinks</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  isLoading</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token boolean" style="color:#AE81FF">false</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  error</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">null</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">startLoading</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color:#F8F8F2">:</span><span class="token parameter"> IssuesState</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">isLoading</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token boolean" style="color:#AE81FF">true</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">loadingFailed</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color:#F8F8F2">:</span><span class="token parameter"> IssuesState</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> action</span><span class="token parameter punctuation" style="color:#F8F8F2">:</span><span class="token parameter"> PayloadAction</span><span class="token parameter operator" style="color:#F8F8F2">&lt;</span><span class="token parameter">string</span><span class="token parameter operator" style="color:#F8F8F2">&gt;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">isLoading</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token boolean" style="color:#AE81FF">false</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">error</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">payload</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> issues </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">createSlice</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  name</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;issues&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  initialState</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> issuesInitialState</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  reducers</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    getIssueStart</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> startLoading</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    getIssuesStart</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> startLoading</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">getIssueSuccess</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> </span><span class="token parameter punctuation" style="color:#F8F8F2">{</span><span class="token parameter"> payload </span><span class="token parameter punctuation" style="color:#F8F8F2">}</span><span class="token parameter punctuation" style="color:#F8F8F2">:</span><span class="token parameter"> PayloadAction</span><span class="token parameter operator" style="color:#F8F8F2">&lt;</span><span class="token parameter">Issue</span><span class="token parameter operator" style="color:#F8F8F2">&gt;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token builtin" style="color:#a6e22e">number</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> payload</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">issuesByNumber</span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token builtin" style="color:#a6e22e">number</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> payload</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">isLoading</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token boolean" style="color:#AE81FF">false</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">error</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">null</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">getIssuesSuccess</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> </span><span class="token parameter punctuation" style="color:#F8F8F2">{</span><span class="token parameter"> payload </span><span class="token parameter punctuation" style="color:#F8F8F2">}</span><span class="token parameter punctuation" style="color:#F8F8F2">:</span><span class="token parameter"> PayloadAction</span><span class="token parameter operator" style="color:#F8F8F2">&lt;</span><span class="token parameter">IssuesResult</span><span class="token parameter operator" style="color:#F8F8F2">&gt;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> pageCount</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> issues</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> pageLinks </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> payload</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">pageCount</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> pageCount</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">pageLinks</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> pageLinks</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">isLoading</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token boolean" style="color:#AE81FF">false</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">error</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">null</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      issues</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">forEach</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">issue</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">issuesByNumber</span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token plain">issue</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">number</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> issue</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">currentPageIssues</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> issues</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">map</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">issue</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> issue</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">number</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    getIssueFailure</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> loadingFailed</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    getIssuesFailure</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> loadingFailed</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  getIssuesStart</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  getIssuesSuccess</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  getIssueStart</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  getIssueSuccess</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  getIssueFailure</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  getIssuesFailure</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> issues</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">actions</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">default</span><span class="token plain"> issues</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">reducer</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> fetchIssues </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  org</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#a6e22e">string</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  repo</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#a6e22e">string</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  page</span><span class="token operator" style="color:#F8F8F2">?</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#a6e22e">number</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token parameter">AppThunk</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">async</span><span class="token plain"> </span><span class="token parameter">dispatch</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token function" style="color:#E6D874">getIssuesStart</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> issues </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">await</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">getIssues</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">org</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> repo</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> page</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token function" style="color:#E6D874">getIssuesSuccess</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">issues</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token function" style="color:#E6D874">getIssuesFailure</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">toString</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> fetchIssue </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  org</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#a6e22e">string</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  repo</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#a6e22e">string</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token builtin" style="color:#a6e22e">number</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#a6e22e">number</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token parameter">AppThunk</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">async</span><span class="token plain"> </span><span class="token parameter">dispatch</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token function" style="color:#E6D874">getIssueStart</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> issue </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">await</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">getIssue</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">org</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> repo</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token builtin" style="color:#a6e22e">number</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token function" style="color:#E6D874">getIssueSuccess</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">issue</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token function" style="color:#E6D874">getIssueFailure</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">toString</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span></div></div></div></div></div><p>This slice is a bit longer, but it&#x27;s the same basic approach as before: write the slice with reducers that handle API call results, then write thunks that do the fetching and dispatch actions with those results. The only new and interesting bits in this slice are:</p><ul><li>Our &quot;start loading&quot; and &quot;loading failed&quot; reducer logic is the same for both the single issue and multiple issue fetch cases. So, we write those functions outside the slice once, then reuse them multiple times inside the <code>reducers</code> object.</li><li>The Github API returns an array of issue entries, but we <a href="https://redux.js.org/recipes/structuring-reducers/normalizing-state-shape" target="_blank" rel="noopener noreferrer">want to store the data in a &quot;normalized&quot; structure to make it easy to look up an issue by its number</a>. In this case, we use a plain object as a lookup table, by declaring that it is a <code>Record&lt;number, Issue&gt;</code>.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="fetching-issues-in-the-issues-list"></a>Fetching Issues in the Issues List<a aria-hidden="true" tabindex="-1" class="hash-link" href="#fetching-issues-in-the-issues-list" title="Direct link to heading">#</a></h3><p>Now we can finish converting the <code>&lt;IssuesListPage&gt;</code> component by swapping out the issues fetching logic.</p><blockquote><ul><li><a href="https://github.com/reduxjs/rtk-github-issues-example/compare/Update_IssuesListPage_to_fetch_issues_data_via_Redux~1..reduxjs:Update_IssuesListPage_to_fetch_issues_data_via_Redux" target="_blank" rel="noopener noreferrer">Update IssuesListPage to fetch issues data via Redux</a></li></ul></blockquote><p>Let&#x27;s look at the changes.</p><p><strong>features/issuesList/IssuesListPage.tsx</strong></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-diff codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-import React, { useState, useEffect } from &#x27;react&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+import React, { useEffect } from &#x27;react&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain">import { useSelector, useDispatch } from &#x27;react-redux&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token deleted-sign deleted" style="color:#F92672">-import { getIssues, IssuesResult } from &#x27;api/githubAPI&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">import { fetchIssuesCount } from &#x27;features/repoSearch/repoDetailsSlice&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">import { RootState } from &#x27;app/rootReducer&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">import { IssuesPageHeader } from &#x27;./IssuesPageHeader&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">import { IssuesList } from &#x27;./IssuesList&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">import { IssuePagination, OnPageChangeCallback } from &#x27;./IssuePagination&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+import { fetchIssues } from &#x27;./issuesSlice&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">// omit code</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token unchanged">  const dispatch = useDispatch()</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token deleted-sign deleted" style="color:#F92672">- const [issuesResult, setIssues] = useState&lt;IssuesResult&gt;({</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-   pageLinks: null,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-   pageCount: 1,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-   issues: []</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">- })</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">- const [isLoading, setIsLoading] = useState&lt;boolean&gt;(false)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">- const [issuesError, setIssuesError] = useState&lt;Error | null&gt;(null)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+ const {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+   currentPageIssues,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+   isLoading,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+   error: issuesError,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+   issuesByNumber,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+   pageCount</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+ } = useSelector((state: RootState) =&gt; state.issues)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token unchanged">  const openIssueCount = useSelector(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">    (state: RootState) =&gt; state.repoDetails.openIssuesCount</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">  )</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token deleted-sign deleted" style="color:#F92672">- const { issues, pageCount } = issuesResult</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+ const issues = currentPageIssues.map(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+   issueNumber =&gt; issuesByNumber[issueNumber]</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+ )</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token unchanged">  useEffect(() =&gt; {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged"></span><span class="token deleted-sign deleted" style="color:#F92672">-   async function fetchEverything() {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-     async function fetchIssues() {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-       const issuesResult = await getIssues(org, repo, page)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-       setIssues(issuesResult)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-     }</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-     try {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-       await Promise.all([</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-        fetchIssues(),</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-        dispatch(fetchIssuesCount(org, repo))</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-       ])</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-       setIssuesError(null)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-     } catch (err) {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-       console.error(err)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-       setIssuesError(err)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-     } finally {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-       setIsLoading(false)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-     }</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-   }</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-    setIsLoading(true)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-    fetchEverything()</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+    dispatch(fetchIssues(org, repo, page))</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+    dispatch(fetchIssuesCount(org, repo))</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token unchanged">  }, [org, repo, page, dispatch])</span></div></div></div></div></div><p>We remove the remaining <code>useState</code> hooks from <code>&lt;IssuesListPage&gt;</code>, add another <code>useSelector</code> to retrieve the actual issues data from the Redux store, and construct the list of issues to render by mapping over the &quot;current page issue IDs&quot; array to look up each issue object by its ID.</p><p>In our <code>useEffect</code>, we delete the rest of the data fetching logic that&#x27;s directly in the component, and just dispatch both data fetching thunks.</p><p>This simplifies the logic in the component, but it didn&#x27;t remove the work being done - it just moved it elsewhere. Again, it&#x27;s not that either approach is &quot;right&quot; or &quot;wrong&quot; - it&#x27;s just a question of where you want the data and the logic to live, and which approach is more maintainable for your app and situation.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="converting-the-issue-details-page"></a>Converting the Issue Details Page<a aria-hidden="true" tabindex="-1" class="hash-link" href="#converting-the-issue-details-page" title="Direct link to heading">#</a></h2><p>The last major chunk of work left in the conversion is the <code>&lt;IssueDetailsPage&gt;</code> component. Let&#x27;s take a look at what it does.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="reviewing-the-issue-details-component"></a>Reviewing the Issue Details Component<a aria-hidden="true" tabindex="-1" class="hash-link" href="#reviewing-the-issue-details-component" title="Direct link to heading">#</a></h3><p>Here&#x27;s the current first half of <code>&lt;IssueDetailsPage&gt;</code>, containing the state and data fetching:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-ts codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color:#E6D874">IssueDetailsPage</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter punctuation" style="color:#F8F8F2">{</span><span class="token parameter"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token parameter">  org</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token parameter">  repo</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token parameter">  issueId</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token parameter">  showIssuesList</span></div><div class="token-line" style="color:#f8f8f2"><span class="token parameter"></span><span class="token parameter punctuation" style="color:#F8F8F2">}</span><span class="token parameter punctuation" style="color:#F8F8F2">:</span><span class="token parameter"> IDProps</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token plain">issue</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> setIssue</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> useState</span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token maybe-class-name">Issue</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">|</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">null</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token keyword" style="color:#F92672">null</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token plain">comments</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> setComments</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> useState</span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token maybe-class-name">Comment</span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token plain">commentsError</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> setCommentsError</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> useState</span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token known-class-name class-name">Error</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">|</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">null</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token keyword" style="color:#F92672">null</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#E6D874">useEffect</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">async</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">fetchIssue</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#F92672">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token function" style="color:#E6D874">setCommentsError</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token keyword" style="color:#F92672">null</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> issue </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">await</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">getIssue</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">org</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> repo</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> issueId</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token function" style="color:#E6D874">setIssue</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">issue</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token function" style="color:#E6D874">setCommentsError</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">fetchIssue</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token plain">org</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> repo</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> issueId</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#E6D874">useEffect</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">async</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">fetchComments</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#F92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">issue </span><span class="token operator" style="color:#F8F8F2">!==</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">null</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> comments </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">await</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">getComments</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">issue</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">comments_url</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token function" style="color:#E6D874">setComments</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">comments</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">fetchComments</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token plain">issue</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#778090">// omit rendering</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span></div></div></div></div></div><p>It&#x27;s very similar to <code>&lt;IssuesListPage&gt;</code>. We store the current displayed <code>Issue</code>, the fetched comments, and a potential error. We have <code>useEffect</code> hooks that fetch the current issue by its ID, and fetch the comments whenever the issue changes.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="fetching-the-current-issue"></a>Fetching the Current Issue<a aria-hidden="true" tabindex="-1" class="hash-link" href="#fetching-the-current-issue" title="Direct link to heading">#</a></h3><p>We conveniently already have the Redux logic for fetching a single issue - we wrote that already as part of <code>issuesSlice.ts</code>. So, we can immediately jump straight to using that here in <code>&lt;IssueDetailsPage&gt;</code>.</p><blockquote><ul><li><a href="https://github.com/reduxjs/rtk-github-issues-example/compare/Update_IssueDetailsPage_to_fetch_issue_data_via_Redux~1..reduxjs:Update_IssueDetailsPage_to_fetch_issue_data_via_Redux" target="_blank" rel="noopener noreferrer">Update IssueDetailsPage to fetch issue data via Redux</a></li></ul></blockquote><p><strong>features/issueDetails/IssueDetailsPage.tsx</strong></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-diff codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token plain">import React, { useState, useEffect } from &#x27;react&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+import { useSelector, useDispatch } from &#x27;react-redux&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain">import ReactMarkdown from &#x27;react-markdown&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">import classnames from &#x27;classnames&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">import { insertMentionLinks } from &#x27;utils/stringUtils&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token deleted-sign deleted" style="color:#F92672">-import { getIssue, getComments, Issue, Comment } from &#x27;api/githubAPI&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+import { getComments, Comment } from &#x27;api/githubAPI&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain">import { IssueLabels } from &#x27;components/IssueLabels&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+import { RootState } from &#x27;app/rootReducer&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+import { fetchIssue } from &#x27;features/issuesList/issuesSlice&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">export const IssueDetailsPage = ({</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token unchanged">  org,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">  repo,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">  issueId,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">  showIssuesList</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged"></span><span class="token plain">}: IDProps) =&gt; {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token deleted-sign deleted" style="color:#F92672">- const [issue, setIssue] = useState&lt;Issue | null&gt;(null)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token unchanged">  const [comments, setComments] = useState&lt;Comment[]&gt;([])</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged"></span><span class="token deleted-sign deleted" style="color:#F92672">- const [commentsError, setCommentsError] = useState&lt;Error | null&gt;(null)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+ const dispatch = useDispatch()</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+ const issue = useSelector(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+   (state: RootState) =&gt; state.issues.issuesByNumber[issueId]</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+ )</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token unchanged">  useEffect(() =&gt; {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged"></span><span class="token deleted-sign deleted" style="color:#F92672">-   async function fetchIssue() {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-     try {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-       setCommentsError(null)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-       const issue = await getIssue(org, repo, issueId)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-       setIssue(issue)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-     } catch (err) {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-       setCommentsError(err)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-     }</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-    }</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-    fetchIssue()</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+   if (!issue) {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+      dispatch(fetchIssue(org, repo, issueId))</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+   }</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+   // Since we may have the issue already, ensure we&#x27;re scrolled to the top</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+   window.scrollTo({ top: 0 })</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token deleted-sign deleted" style="color:#F92672">- }, [org, repo, issueId])</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+ }, [org, repo, issueId, issue, dispatch])</span></div></div></div></div></div><p>We continue the usual pattern. We drop the existing <code>useState</code> hooks, pull in <code>useDispatch</code> and the necessary state via <code>useSelector</code>, and dispatch the <code>fetchIssue</code> thunk to fetch data.</p><p>Interestingly, there&#x27;s actually a bit of a change in behavior here. The original React code was storing the fetched issues in <code>&lt;IssuesListPage&gt;</code>, and <code>&lt;IssueDetailsPage&gt;</code> was always having to do a separate fetch for its own issue. Because we&#x27;re now storing issues in the Redux store, most of the time the listed issue <em>should</em> be already cached, and we don&#x27;t even need to fetch it. Now, it&#x27;s totally possible to do something similar with just React - all we&#x27;d have to do is pass the issue down from the parent component. Still, having that data in Redux makes it easier to do the caching.</p><p>(As an interesting side note: the original code always caused the page to jump back to the top, because the issue didn&#x27;t exist during the first render, so there was no content. If the issue <em>does</em> exist and we render it right away, the page may retain the scroll position from the issues list, so we have to enforce scrolling back to the top.)</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="logic-for-fetching-comments"></a>Logic for Fetching Comments<a aria-hidden="true" tabindex="-1" class="hash-link" href="#logic-for-fetching-comments" title="Direct link to heading">#</a></h3><p>We have one more slice left to write - we need to fetch and store comments for the current issue.</p><blockquote><ul><li><a href="https://github.com/reduxjs/rtk-github-issues-example/compare/Add_a_slice_for_tracking_comments_data~1..reduxjs:Add_a_slice_for_tracking_comments_data" target="_blank" rel="noopener noreferrer">Add a slice for tracking comments data</a></li></ul></blockquote><p><strong>features/issueDetails/commentsSlice.ts</strong></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-ts codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> createSlice</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token maybe-class-name">PayloadAction</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;@reduxjs/toolkit&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token maybe-class-name">Comment</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> getComments</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token maybe-class-name">Issue</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;api/githubAPI&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token maybe-class-name">AppThunk</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;app/store&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">interface</span><span class="token plain"> </span><span class="token class-name">CommentsState</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  commentsByIssue</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token maybe-class-name">Record</span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token builtin" style="color:#a6e22e">number</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token maybe-class-name">Comment</span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">|</span><span class="token plain"> undefined</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  loading</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#a6e22e">boolean</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  error</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#a6e22e">string</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">|</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">null</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">interface</span><span class="token plain"> </span><span class="token class-name">CommentLoaded</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  issueId</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token builtin" style="color:#a6e22e">number</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  comments</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token maybe-class-name">Comment</span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> initialState</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token maybe-class-name">CommentsState</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  commentsByIssue</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  loading</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token boolean" style="color:#AE81FF">false</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  error</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">null</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> comments </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">createSlice</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  name</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;comments&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  initialState</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  reducers</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">getCommentsStart</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">loading</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token boolean" style="color:#AE81FF">true</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">error</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">null</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">getCommentsSuccess</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> action</span><span class="token parameter punctuation" style="color:#F8F8F2">:</span><span class="token parameter"> PayloadAction</span><span class="token parameter operator" style="color:#F8F8F2">&lt;</span><span class="token parameter">CommentLoaded</span><span class="token parameter operator" style="color:#F8F8F2">&gt;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> comments</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> issueId </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">payload</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">commentsByIssue</span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token plain">issueId</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> comments</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">loading</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token boolean" style="color:#AE81FF">false</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">error</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">null</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">getCommentsFailure</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> action</span><span class="token parameter punctuation" style="color:#F8F8F2">:</span><span class="token parameter"> PayloadAction</span><span class="token parameter operator" style="color:#F8F8F2">&lt;</span><span class="token parameter">string</span><span class="token parameter operator" style="color:#F8F8F2">&gt;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">loading</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token boolean" style="color:#AE81FF">false</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">error</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">payload</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  getCommentsStart</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  getCommentsSuccess</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  getCommentsFailure</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> comments</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">actions</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">default</span><span class="token plain"> comments</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">reducer</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> fetchComments </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">issue</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token maybe-class-name">Issue</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token parameter">AppThunk</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">async</span><span class="token plain"> </span><span class="token parameter">dispatch</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token function" style="color:#E6D874">getCommentsStart</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> comments </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">await</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">getComments</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">issue</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">comments_url</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token function" style="color:#E6D874">getCommentsSuccess</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> issueId</span><span class="token punctuation" style="color:#F8F8F2">:</span><span class="token plain"> issue</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">number</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> comments </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token function" style="color:#E6D874">getCommentsFailure</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span></div></div></div></div></div><p>The slice should look pretty familiar at this point. Our main bit of state is a lookup table of comments keyed by an issue ID. After the slice, we add a thunk to fetch the comments for a given issue, and dispatch the action to save the resulting array in the slice.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="fetching-the-issue-comments"></a>Fetching the Issue Comments<a aria-hidden="true" tabindex="-1" class="hash-link" href="#fetching-the-issue-comments" title="Direct link to heading">#</a></h3><p>The final step is to swap the comments fetching logic in <code>&lt;IssueDetailsPage&gt;</code>.</p><blockquote><ul><li><a href="https://github.com/reduxjs/rtk-github-issues-example/compare/Update_IssueDetailsPage_to_fetch_comments_via_Redux~1..reduxjs:Update_IssueDetailsPage_to_fetch_comments_via_Redux" target="_blank" rel="noopener noreferrer">Update IssueDetailsPage to fetch comments via Redux</a></li></ul></blockquote><p><strong>features/issueDetails/IssueDetailsPage.tsx</strong></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-diff codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#272822"><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-import React, { useState, useEffect } from &#x27;react&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+import React, { useEffect } from &#x27;react&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token deleted-sign deleted" style="color:#F92672">-import { useSelector, useDispatch } from &#x27;react-redux&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+import { useSelector, useDispatch, shallowEqual } from &#x27;react-redux&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain">import ReactMarkdown from &#x27;react-markdown&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">import classnames from &#x27;classnames&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">import { insertMentionLinks } from &#x27;utils/stringUtils&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token deleted-sign deleted" style="color:#F92672">-import { getComments, Comment } from &#x27;api/githubAPI&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token plain">import { IssueLabels } from &#x27;components/IssueLabels&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">import { RootState } from &#x27;app/rootReducer&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">import { fetchIssue } from &#x27;features/issuesList/issuesSlice&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">import { IssueMeta } from &#x27;./IssueMeta&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">import { IssueComments } from &#x27;./IssueComments&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+import { fetchComments } from &#x27;./commentsSlice&#x27;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">export const IssueDetailsPage = ({</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token unchanged">  org,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">  repo,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">  issueId,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">  showIssuesList</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged"></span><span class="token plain">}: IDProps) =&gt; {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token deleted-sign deleted" style="color:#F92672">- const [comments, setComments] = useState&lt;Comment[]&gt;([])</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">- const [commentsError] = useState&lt;Error | null&gt;(null)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token unchanged">  const dispatch = useDispatch()</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token unchanged">  const issue = useSelector(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">    (state: RootState) =&gt; state.issues.issuesByNumber[issueId]</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged">  )</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+ const { commentsLoading, commentsError, comments } = useSelector(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+   (state: RootState) =&gt; {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+     return {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+       commentsLoading: state.comments.loading,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+       commentsError: state.comments.error,</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+       comments: state.comments.commentsByIssue[issueId]</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+     }</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+   },</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+   shallowEqual</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+ )</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">// omit effect</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token unchanged">  useEffect(() =&gt; {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token unchanged"></span><span class="token deleted-sign deleted" style="color:#F92672">-   async function fetchComments() {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-     if (issue) {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-       const comments = await getComments(issue.comments_url)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-       setComments(comments)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-     }</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-   }</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672">-   fetchComments()</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+   if (issue) {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+     dispatch(fetchComments(issue))</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e">+   }</span></div><div class="token-line" style="color:#f8f8f2"><span class="token inserted-sign inserted" style="color:#a6e22e"></span><span class="token deleted-sign deleted" style="color:#F92672">- }, [issue])</span></div><div class="token-line" style="color:#f8f8f2"><span class="token deleted-sign deleted" style="color:#F92672"></span><span class="token inserted-sign inserted" style="color:#a6e22e">+ }, [issue, dispatch])</span></div></div></div></div></div><p>We add another <code>useSelector</code> hook to pull out the current comments data. In this case, we need three different pieces: the loading flag, a potential error, and the actual comments array for this issue.</p><p>However, this leads to a performance problem. Every time this selector runs, it returns a new object: <code>{commentsLoading, commentsError, comments}</code>. <strong>Unlike <code>connect</code>, <code>useSelector</code> relies on reference equality by default.</strong> So, returning a new object will cause this component to rerender every time an action is dispatched, even if the comments are the same!</p><p>There&#x27;s a few ways to fix this:</p><ul><li>We could write those as separate <code>useSelector</code> calls</li><li>We could use a memoized selector, such as <code>createSelector</code> from Reselect</li><li>We can use the React-Redux <code>shallowEqual</code> function to compare the results, so that the re-render only happens if the object&#x27;s <em>contents</em> have changed.</li></ul><p>In this case, we&#x27;ll add <code>shallowEqual</code> as the comparison function for <code>useSelector</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="summary"></a>Summary<a aria-hidden="true" tabindex="-1" class="hash-link" href="#summary" title="Direct link to heading">#</a></h2><p>And with that, we&#x27;re done! The entire Github Issues app should now be fetching its data via thunks, storing the data in Redux, and interacting with the store via React-Redux hooks. We have Typescript types for our Github API calls, the API types are being used for the Redux state slices, and the store state types are being used in our React components.</p><p>There&#x27;s more that could be done to add more type safety if we wanted (like trying to constrain which possible action types can be passed to <code>dispatch</code>), but this gives us a reasonable &quot;80% solution&quot; without too much extra effort.</p><p>Hopefully you now have a solid understanding of how Redux Toolkit looks in a real world application.</p><p>Let&#x27;s wrap this up with one more look at the complete source code and the running app:</p><iframe src="https://codesandbox.io/embed/rtk-github-issues-example-03-final-ihttc?fontsize=14&amp;hidenavigation=1&amp;module=%2Fsrc%2Ffeatures%2FissueDetails%2FcommentsSlice.ts&amp;theme=dark&amp;view=editor" style="width:100%;height:500px;border:0;border-radius:4px;overflow:hidden" title="rtk-github-issues-example03-final" allow="geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media; usb" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe><p><strong>Now, go out there and build something cool!</strong></p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/redux-toolkit/tutorials/intermediate-tutorial"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ Intermediate Tutorial</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/redux-toolkit/usage/usage-guide"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Usage Guide ¬ª</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#reviewing-the-starting-example-application" class="table-of-contents__link">Reviewing the Starting Example Application</a><ul><li><a href="#react-codebase-source-overview" class="table-of-contents__link">React Codebase Source Overview</a></li></ul></li><li><a href="#setting-up-the-redux-store" class="table-of-contents__link">Setting Up the Redux Store</a></li><li><a href="#converting-the-main-app-display" class="table-of-contents__link">Converting the Main App Display</a><ul><li><a href="#evaluating-the-existing-app-state" class="table-of-contents__link">Evaluating the Existing App State</a></li><li><a href="#creating-the-initial-state-slices" class="table-of-contents__link">Creating the Initial State Slices</a></li><li><a href="#converting-the-issues-display" class="table-of-contents__link">Converting the Issues Display</a></li></ul></li><li><a href="#converting-the-issues-list-page" class="table-of-contents__link">Converting the Issues List Page</a><ul><li><a href="#reviewing-the-issues-list-component" class="table-of-contents__link">Reviewing the Issues List Component</a></li><li><a href="#thinking-in-thunks" class="table-of-contents__link">Thinking in Thunks</a></li><li><a href="#logic-for-fetching-github-repo-details" class="table-of-contents__link">Logic for Fetching Github Repo Details</a></li><li><a href="#fetching-repo-details-in-the-issues-list" class="table-of-contents__link">Fetching Repo Details in the Issues List</a></li><li><a href="#logic-for-fetching-issues-for-a-repo" class="table-of-contents__link">Logic for Fetching Issues for a Repo</a></li><li><a href="#fetching-issues-in-the-issues-list" class="table-of-contents__link">Fetching Issues in the Issues List</a></li></ul></li><li><a href="#converting-the-issue-details-page" class="table-of-contents__link">Converting the Issue Details Page</a><ul><li><a href="#reviewing-the-issue-details-component" class="table-of-contents__link">Reviewing the Issue Details Component</a></li><li><a href="#fetching-the-current-issue" class="table-of-contents__link">Fetching the Current Issue</a></li><li><a href="#logic-for-fetching-comments" class="table-of-contents__link">Logic for Fetching Comments</a></li><li><a href="#fetching-the-issue-comments" class="table-of-contents__link">Fetching the Issue Comments</a></li></ul></li><li><a href="#summary" class="table-of-contents__link">Summary</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/redux-toolkit/introduction/quick-start">Come√ßo r√°pido</a></li><li class="footer__item"><a class="footer__link-item" href="/redux-toolkit/api/configureStore">Refer√™ncia de API</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Comunidade</h4><ul class="footer__items"><li class="footer__item"><a href="http://stackoverflow.com/questions/tagged/redux" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://discord.gg/0ZcbPKXt5bZ6au5t" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Mais</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.github.com/reduxjs/redux-toolkit" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item">
                <a href="https://www.netlify.com">
                  <img src="https://www.netlify.com/img/global/badges/netlify-light.svg" alt="Deploys by Netlify">
                </a>
              </li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><img class="footer__logo" alt="Redux Logo" src="/redux-toolkit/img/redux_white.svg"></div><div>Direito autoral ¬© 2015‚Äì2021 Dan Abramov and the Redux documentation authors.</div></div></div></footer></div>
<script src="/redux-toolkit/styles.eb99357f.js"></script>
<script src="/redux-toolkit/runtime~main.68ebf52a.js"></script>
<script src="/redux-toolkit/main.3d9f7115.js"></script>
<script src="/redux-toolkit/1.57fadc6f.js"></script>
<script src="/redux-toolkit/2.2b7db848.js"></script>
<script src="/redux-toolkit/27.1911eaf1.js"></script>
<script src="/redux-toolkit/30.fc892cc4.js"></script>
<script src="/redux-toolkit/f976f453.bed7d5e1.js"></script>
<script src="/redux-toolkit/17896441.4d650456.js"></script>
<script src="/redux-toolkit/1d5ff78c.5acaff8d.js"></script>
</body>
</html>